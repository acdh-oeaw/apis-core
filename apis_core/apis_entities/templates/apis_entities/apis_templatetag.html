<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/css/bootstrap-multiselect.css" />
<script src="https://cdn.jsdelivr.net/npm/tooltipster@4.2.6/dist/js/tooltipster.bundle.min.js" integrity="sha256-glChvCaC6IJq49dkfulAWd7xlkPwA0FEydjhjPBintA=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.6/dist/css/tooltipster.bundle.min.css" integrity="sha256-Qc4lCfqZWYaHF5hgEOFrYzSIX9Rrxk0NPHRac+08QeQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.6/src/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-light.css" integrity="sha256-TCVc2Qc+NEQu24pQ9XbBwEZivtNyIPCqn6kE92Y8Fys=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.4/leaflet.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.4/leaflet.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" /> -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.full.min.js"></script>
<script type="text/javascript">
            // Setup plugin with default settings
            $(document).ready(function() {
                $.apScrollTop({
                    'onInit': function(evt) {
                        console.log('apScrollTop: init');
                    }
                });
	$(document).on('submit', 'form.form.ajax_form', unbind_ajax_forms);
            });
    </script>
    <script type="text/javascript">
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

    </script>
    <script type="text/javascript">
      function unbind_ajax_forms(event){
	   $(this).find('button').attr('disabled', true);
            event.preventDefault();
            event.stopPropagation();
            var formData = $(this).serialize();
            //var button_text = $(this).find(':button').text();
          $.ajax({
          type: 'POST',
          url: $(this).attr('action'),
          data: formData,
              beforeSend: function(request) {
              var csrftoken = getCookie('csrftoken');
    request.setRequestHeader("X-CSRFToken", csrftoken);
  },
          //data:formData,
            })
          .done(function(response) {
              window[response.call_function](response)}
      )}
</script>
        <script type="text/javascript">
    //script that converts the multi select element of the annotation project menu
    $(document).ready(function() {
        $('select.selectmultiple').multiselect({
            includeSelectAllOption: true,
            enableFiltering: true
        });
        initiate_compare_tooltip();
    })
    </script>
        <script type="application/javascript">
		console.log('script loaded');
		$(document).on('mouseenter', 'span.apis-autocomplete-span:not(.tooltipstered)', function(e) {
                    
        console.log('mouse event triggered');
			console.log(this);
			console.log(e);
			$(this).tooltipster({
                      theme: 'tooltipster-light',
		      trigger: 'hover',
		      content: 'loading...',
		      side: 'left',
		      contentAsHTML: true,
		      interactive: true,

                      functionInit: function(instance, helper) {
                        console.log(helper);
			      if (typeof $.ApisAutoCount == 'undefined') {
				      $.ApisAutoCount = 0; } else {
				     $.ApisAutoCount += 1; 
				      };

                        var elem_id = 'auto_comp_extra_'+$.ApisAutoCount
                        var func = 'autocomplete_vis_'+$(helper.origin).data('vis-tooltip');
			      console.log(func);

                        var res = window[func]($(helper.origin), elem_id);
                        console.log('went through');
			instance.elem_id = elem_id;
			console.log(instance)
			      //return instance
		      },
                    })
				.tooltipster('open');
                });


        function initiate_compare_tooltip() {
          //TODO: correctly detach the tooltips before reinitializing them
        $('.compare_tooltip').tooltipster({
    content: 'Loading...',
            contentAsHTML: true,
    interactive: true,
    theme: 'tooltipster-light',
            updateAnimation: null,
            zIndex: 999,
    functionBefore: function(instance, helper) {
        var $origin = $(helper.origin);
        dataOptions = $origin.attr('data-tooltip');
        if(dataOptions) {

            dataOptions = JSON.parse(dataOptions);
            console.log(dataOptions);
        } else {
            console.log('didnt read out')
        }
        if (typeof $.ApisRev == 'undefined') {
            $.ApisRev = {}; }
        $.ApisRev.url = '/apis/entities/compare/'+dataOptions['app']+'/'+dataOptions['kind']+'/'+dataOptions['pk']
        if ($origin.data('loaded') !== true) {
            $.get($.ApisRev.url, function(data) {
                instance.content(data);
                unbind_compare_forms();
                $origin.data('loaded', true);
            });
        }
    },
    functionReady: function (instance, helper) {
        $.ApisRev.instance = instance;
        unbind_compare_forms();
    }
});};
        </script>
        <script type="text/javascript">
      function unbind_compare_forms(){
      $("#change-history").parents('form').submit(function(event) {
            event.preventDefault();
            event.stopPropagation();
            var formData = $(this).serialize();
          if ($.ApisRev.url == 'undefined'){
              var url = '/'
          } else {
              var url = $.ApisRev.url
          };
          $.ajax({
          type: 'GET',
          url: url,
          data: formData,
          //data:formData,
            })
          .done(function(response) {
              $.ApisRev.instance.content(response);
              unbind_compare_forms();
          }
      )})}
</script>
