{"title": "helper_functions.RDFparsers", "current_page_name": "_modules/helper_functions/RDFparsers", "body": "<h1>Source code for helper_functions.RDFparsers</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"ch\">#!/usr/bin/python</span>\n<span class=\"c1\"># -*- coding: utf-8 -*-</span>\n<span class=\"kn\">from</span> <span class=\"nn\">entities.models</span> <span class=\"k\">import</span> <span class=\"n\">Place</span><span class=\"p\">,</span> <span class=\"n\">Institution</span><span class=\"p\">,</span> <span class=\"n\">Person</span><span class=\"p\">,</span> <span class=\"n\">Work</span>\n<span class=\"kn\">from</span> <span class=\"nn\">relations.models</span> <span class=\"k\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">InstitutionInstitution</span><span class=\"p\">,</span> <span class=\"n\">InstitutionPlace</span><span class=\"p\">,</span> <span class=\"n\">PersonPerson</span><span class=\"p\">,</span>\n    <span class=\"n\">PersonWork</span><span class=\"p\">,</span> <span class=\"n\">PersonPlace</span><span class=\"p\">,</span> <span class=\"n\">PersonInstitution</span><span class=\"p\">,</span> <span class=\"n\">PlacePlace</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">metainfo.models</span> <span class=\"k\">import</span> <span class=\"n\">Uri</span> <span class=\"k\">as</span> <span class=\"n\">genUri</span>\n<span class=\"kn\">from</span> <span class=\"nn\">labels.models</span> <span class=\"k\">import</span> <span class=\"n\">Label</span>\n<span class=\"kn\">from</span> <span class=\"nn\">vocabularies.models</span> <span class=\"k\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">LabelType</span><span class=\"p\">,</span> <span class=\"n\">InstitutionInstitutionRelation</span><span class=\"p\">,</span>\n    <span class=\"n\">InstitutionPlaceRelation</span><span class=\"p\">,</span> <span class=\"n\">VocabsUri</span><span class=\"p\">,</span> <span class=\"n\">ProfessionType</span><span class=\"p\">,</span> <span class=\"n\">PersonWorkRelation</span><span class=\"p\">,</span>\n    <span class=\"n\">PersonPersonRelation</span><span class=\"p\">,</span> <span class=\"n\">PersonPlaceRelation</span><span class=\"p\">,</span> <span class=\"n\">WorkType</span><span class=\"p\">,</span> <span class=\"n\">PersonInstitutionRelation</span><span class=\"p\">,</span>\n    <span class=\"n\">PlaceType</span><span class=\"p\">,</span> <span class=\"n\">PlacePlaceRelation</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">apis.settings.NER_settings</span> <span class=\"k\">import</span> <span class=\"n\">geonames_feature_codes</span> <span class=\"k\">as</span> <span class=\"n\">gn_f</span>\n<span class=\"kn\">from</span> <span class=\"nn\">apis.settings.RDF_settings</span> <span class=\"k\">import</span> <span class=\"n\">sett_RDF_generic</span>\n<span class=\"kn\">from</span> <span class=\"nn\">metainfo.models</span> <span class=\"k\">import</span> <span class=\"n\">Collection</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">rdflib</span>\n<span class=\"kn\">from</span> <span class=\"nn\">rdflib</span> <span class=\"k\">import</span> <span class=\"n\">ConjunctiveGraph</span><span class=\"p\">,</span> <span class=\"n\">URIRef</span><span class=\"p\">,</span> <span class=\"n\">RDFS</span><span class=\"p\">,</span> <span class=\"n\">Literal</span><span class=\"p\">,</span> <span class=\"n\">OWL</span>\n<span class=\"kn\">import</span> <span class=\"nn\">re</span>\n<span class=\"kn\">from</span> <span class=\"nn\">datetime</span> <span class=\"k\">import</span> <span class=\"n\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"nn\">types</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models</span> <span class=\"k\">import</span> <span class=\"n\">Q</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.contenttypes.models</span> <span class=\"k\">import</span> <span class=\"n\">ContentType</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.exceptions</span> <span class=\"k\">import</span> <span class=\"n\">FieldError</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">geonamesPlace</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">gno</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;http://www.geonames.org/ontology#&#39;</span>\n        <span class=\"n\">wgs84</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;http://www.w3.org/2003/01/geo/wgs84_pos#&quot;</span>\n        <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">Graph</span><span class=\"p\">()</span>\n        <span class=\"n\">o2</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n        <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">pref_name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;officialName&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">alt_name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;alternateName&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">fcode</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;featureCode&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">lat</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">wgs84</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;lat&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">lng</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">wgs84</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;long&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">country</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;parentCountry&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">de_name</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"n\">labels_list</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"si\">{}</span><span class=\"s1\">about.rdf&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()),</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;xml&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">alt_name</span><span class=\"p\">,</span> <span class=\"n\">pref_name</span><span class=\"p\">]:</span>\n            <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">z</span><span class=\"p\">):</span>\n                <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">language</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;de&#39;</span><span class=\"p\">:</span>\n                    <span class=\"n\">de_name</span> <span class=\"o\">=</span> <span class=\"n\">x</span>\n                <span class=\"k\">elif</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">language</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;en&#39;</span><span class=\"p\">:</span>\n                    <span class=\"n\">labels_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">de_name</span><span class=\"p\">:</span>\n            <span class=\"n\">o_name</span> <span class=\"o\">=</span> <span class=\"n\">de_name</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">o_name</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n        <span class=\"n\">o_lat</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">lat</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n        <span class=\"n\">o_lng</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">lng</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n        <span class=\"n\">o_feature</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">fcode</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n        <span class=\"n\">p_type</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PlaceType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\"> (</span><span class=\"si\">{}</span><span class=\"s2\">)&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">gn_f</span><span class=\"p\">[</span><span class=\"n\">o_feature</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()][</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">o_feature</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()),</span>\n            <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">gn_f</span><span class=\"p\">[</span><span class=\"n\">o_feature</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n        <span class=\"k\">if</span> <span class=\"n\">entity</span><span class=\"p\">:</span>\n            <span class=\"n\">entity</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">o_name</span>\n            <span class=\"n\">entity</span><span class=\"o\">.</span><span class=\"n\">lat</span> <span class=\"o\">=</span> <span class=\"n\">o_lat</span>\n            <span class=\"n\">entity</span><span class=\"o\">.</span><span class=\"n\">lng</span> <span class=\"o\">=</span> <span class=\"n\">o_lng</span>\n            <span class=\"n\">entity</span><span class=\"o\">.</span><span class=\"n\">kind</span> <span class=\"o\">=</span> <span class=\"n\">p_type</span>\n            <span class=\"n\">entity</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">entity</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">Place</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">o_name</span><span class=\"p\">,</span> <span class=\"n\">lat</span><span class=\"o\">=</span><span class=\"n\">o_lat</span><span class=\"p\">,</span> <span class=\"n\">lng</span><span class=\"o\">=</span><span class=\"n\">o_lng</span><span class=\"p\">,</span> <span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">p_type</span><span class=\"p\">,</span> <span class=\"n\">status</span><span class=\"o\">=</span><span class=\"s1\">&#39;distinct&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">place</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">def_coll</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">Collection</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Default import collection&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">place</span><span class=\"o\">.</span><span class=\"n\">collection</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">def_coll</span><span class=\"p\">)</span>\n        <span class=\"n\">uri2</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s1\">&#39;http://sws.geonames.org/&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">,</span> <span class=\"n\">loaded</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n        <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">altN</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">LabelType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;alternative name&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">labels_list</span><span class=\"p\">:</span>\n            <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">isoCode_639_3</span><span class=\"o\">=</span><span class=\"s1\">&#39;eng&#39;</span><span class=\"p\">,</span> <span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">,</span> <span class=\"n\">label_type</span><span class=\"o\">=</span><span class=\"n\">altN</span><span class=\"p\">)</span>\n            <span class=\"n\">l</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">o_country</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">country</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">o_country</span> <span class=\"o\">!=</span> <span class=\"s1\">&#39;None&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">cntr</span> <span class=\"o\">=</span> <span class=\"n\">geonamesPlace</span><span class=\"p\">(</span><span class=\"n\">o_country</span><span class=\"p\">)</span>\n            <span class=\"n\">lin</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PlacePlaceRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;located in&#39;</span><span class=\"p\">,</span> <span class=\"n\">defaults</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;name_reverse&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;includes&#39;</span><span class=\"p\">})</span>\n            <span class=\"n\">rel_cntr</span> <span class=\"o\">=</span> <span class=\"n\">PlacePlace</span><span class=\"p\">(</span><span class=\"n\">related_placeA</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">,</span> <span class=\"n\">related_placeB</span><span class=\"o\">=</span><span class=\"n\">cntr</span><span class=\"p\">,</span> <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">lin</span><span class=\"p\">)</span>\n            <span class=\"n\">rel_cntr</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"n\">place</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">geonamesPlaceCL</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">uri</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"k\">def</span> <span class=\"nf\">exist</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"kc\">False</span>\n        <span class=\"n\">force</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;force&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">test</span> <span class=\"o\">=</span> <span class=\"n\">exist</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">uri</span> <span class=\"o\">=</span> <span class=\"n\">uri</span>\n        <span class=\"k\">if</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">force</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"n\">gno</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;http://www.geonames.org/ontology#&#39;</span>\n            <span class=\"n\">wgs84</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;http://www.w3.org/2003/01/geo/wgs84_pos#&quot;</span>\n            <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">Graph</span><span class=\"p\">()</span>\n            <span class=\"n\">o2</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n            <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">pref_name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;officialName&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">alt_name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;alternateName&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">fcode</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;featureCode&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">lat</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">wgs84</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;lat&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">lng</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">wgs84</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;long&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">country</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">gno</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;parentCountry&#39;</span><span class=\"p\">)</span>\n            <span class=\"n\">de_name</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n            <span class=\"n\">labels_list</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n            <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"si\">{}</span><span class=\"s1\">about.rdf&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()),</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;xml&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">graph</span> <span class=\"o\">=</span> <span class=\"n\">result</span>\n            <span class=\"k\">for</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">alt_name</span><span class=\"p\">,</span> <span class=\"n\">pref_name</span><span class=\"p\">]:</span>\n                <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">z</span><span class=\"p\">):</span>\n                    <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">language</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;de&#39;</span><span class=\"p\">:</span>\n                        <span class=\"n\">de_name</span> <span class=\"o\">=</span> <span class=\"n\">x</span>\n                    <span class=\"k\">elif</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">language</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;en&#39;</span><span class=\"p\">:</span>\n                        <span class=\"n\">labels_list</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">))</span>\n            <span class=\"k\">if</span> <span class=\"n\">de_name</span><span class=\"p\">:</span>\n                <span class=\"n\">o_name</span> <span class=\"o\">=</span> <span class=\"n\">de_name</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">o_name</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n            <span class=\"n\">o_lat</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">lat</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n            <span class=\"n\">o_lng</span> <span class=\"o\">=</span> <span class=\"nb\">float</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">lng</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n            <span class=\"n\">o_feature</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">fcode</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n            <span class=\"n\">p_type</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PlaceType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\"> (</span><span class=\"si\">{}</span><span class=\"s2\">)&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">gn_f</span><span class=\"p\">[</span><span class=\"n\">o_feature</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()][</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">o_feature</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()),</span>\n                <span class=\"n\">description</span><span class=\"o\">=</span><span class=\"n\">gn_f</span><span class=\"p\">[</span><span class=\"n\">o_feature</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n            <span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">Place</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">o_name</span><span class=\"p\">,</span> <span class=\"n\">lat</span><span class=\"o\">=</span><span class=\"n\">o_lat</span><span class=\"p\">,</span> <span class=\"n\">lng</span><span class=\"o\">=</span><span class=\"n\">o_lng</span><span class=\"p\">,</span> <span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">p_type</span><span class=\"p\">,</span> <span class=\"n\">status</span><span class=\"o\">=</span><span class=\"s1\">&#39;distinct&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">place</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">labels_list</span> <span class=\"o\">=</span> <span class=\"n\">labels_list</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">country</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">country</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">save_place</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span>\n        <span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">altN</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">LabelType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;alternative name&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">labels_list</span><span class=\"p\">:</span>\n            <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">x</span><span class=\"p\">,</span> <span class=\"n\">isoCode_639_3</span><span class=\"o\">=</span><span class=\"s1\">&#39;eng&#39;</span><span class=\"p\">,</span> <span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">,</span> <span class=\"n\">label_type</span><span class=\"o\">=</span><span class=\"n\">altN</span><span class=\"p\">)</span>\n            <span class=\"n\">l</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">country</span> <span class=\"o\">!=</span> <span class=\"s1\">&#39;None&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">cntr</span> <span class=\"o\">=</span> <span class=\"n\">geonamesPlaceCL</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">country</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">cntr</span><span class=\"o\">.</span><span class=\"n\">created</span><span class=\"p\">:</span>\n                <span class=\"n\">cntr</span> <span class=\"o\">=</span> <span class=\"n\">cntr</span><span class=\"o\">.</span><span class=\"n\">save_place</span><span class=\"p\">()</span>\n            <span class=\"n\">lin</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PlacePlaceRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;located in&#39;</span><span class=\"p\">,</span> <span class=\"n\">defaults</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;name_reverse&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;includes&#39;</span><span class=\"p\">})</span>\n            <span class=\"n\">rel_cntr</span> <span class=\"o\">=</span> <span class=\"n\">PlacePlace</span><span class=\"p\">(</span><span class=\"n\">related_placeA</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">,</span> <span class=\"n\">related_placeB</span><span class=\"o\">=</span><span class=\"n\">cntr</span><span class=\"o\">.</span><span class=\"n\">place</span><span class=\"p\">,</span> <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">lin</span><span class=\"p\">)</span>\n            <span class=\"n\">rel_cntr</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">uri2</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">uri</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s1\">&#39;http://sws.geonames.org/&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">,</span> <span class=\"n\">loaded</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n        <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">def_coll</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">Collection</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Default import collection&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">place</span><span class=\"o\">.</span><span class=\"n\">collection</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">def_coll</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">place</span>\n        <span class=\"k\">return</span> <span class=\"n\">place</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">merge</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span><span class=\"p\">)</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"n\">Place</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">False</span>\n        <span class=\"k\">for</span> <span class=\"n\">rel</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">PersonPlace</span><span class=\"p\">,</span> <span class=\"n\">InstitutionPlace</span><span class=\"p\">]:</span>\n            <span class=\"k\">for</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"n\">rel</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">entity</span><span class=\"p\">):</span>\n                <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">related_place</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span>\n                <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"n\">PlacePlace</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_placeA</span><span class=\"o\">=</span><span class=\"n\">entity</span><span class=\"p\">)</span> <span class=\"o\">|</span> <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_placeB</span><span class=\"o\">=</span><span class=\"n\">entity</span><span class=\"p\">)):</span>\n            <span class=\"k\">if</span> <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">related_placeA</span> <span class=\"o\">==</span> <span class=\"n\">entity</span><span class=\"p\">:</span>\n                <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">related_placeA</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">related_placeB</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span>\n            <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"n\">Label</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">entity</span><span class=\"p\">):</span>\n            <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">temp_entity</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span>\n            <span class=\"n\">z</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">entity</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span>\n\n\n\n\n<span class=\"k\">def</span> <span class=\"nf\">gndPlace</span><span class=\"p\">(</span><span class=\"n\">txt</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">)</span>\n    <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">Graph</span><span class=\"p\">()</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"n\">txt</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;/about/rdf&#39;</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;xml&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">sameAs</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://www.w3.org/2002/07/owl#sameAs&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">o2</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">txt</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">sameAs</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"s1\">&#39;http://sws.geonames.org/&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">x</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">!=</span> <span class=\"s1\">&#39;/&#39;</span><span class=\"p\">:</span>\n                <span class=\"n\">x</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;/&#39;</span>\n            <span class=\"n\">pl</span> <span class=\"o\">=</span> <span class=\"n\">geonamesPlace</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n            <span class=\"n\">uri2</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s1\">&#39;http://d-nb.info/gnd/&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">pl</span><span class=\"p\">)</span>\n            <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"k\">return</span> <span class=\"n\">pl</span>\n    <span class=\"n\">uri2</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s1\">&#39;http://d-nb.info/gnd/&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">placeName</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">foundation</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">latLong</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">geonames</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"k\">for</span> <span class=\"n\">subj</span><span class=\"p\">,</span> <span class=\"n\">pred</span><span class=\"p\">,</span> <span class=\"n\">obj</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#preferredNameForThePlaceOrGeographicName&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">placeName</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#variantNameForThePlaceOrGeographicName&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">labels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#dateOfEstablishment&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">foundation</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://www.opengis.net/ont/geosparql#asWKT&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">latLong</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://www.w3.org/2002/07/owl#sameAs&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">geonames</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">latLong</span><span class=\"p\">:</span>\n        <span class=\"n\">match</span> <span class=\"o\">=</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">match</span><span class=\"p\">(</span>\n            <span class=\"s1\">r&#39;Point \\( ([\\+\\-][0-9]</span><span class=\"si\">{3}</span><span class=\"s1\">\\.[0-9]</span><span class=\"si\">{6}</span><span class=\"s1\">) ([\\+\\-][0-9]</span><span class=\"si\">{3}</span><span class=\"s1\">\\.[0-9]</span><span class=\"si\">{6}</span><span class=\"s1\">) \\)&#39;</span><span class=\"p\">,</span> <span class=\"n\">latLong</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">match</span><span class=\"p\">:</span>\n            <span class=\"n\">lat</span> <span class=\"o\">=</span> <span class=\"n\">match</span><span class=\"o\">.</span><span class=\"n\">group</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n            <span class=\"n\">lng</span> <span class=\"o\">=</span> <span class=\"n\">match</span><span class=\"o\">.</span><span class=\"n\">group</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">lat</span> <span class=\"o\">=</span> <span class=\"n\">lng</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">lat</span> <span class=\"o\">=</span> <span class=\"n\">lng</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">Place</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">placeName</span><span class=\"p\">,</span> <span class=\"n\">lat</span><span class=\"o\">=</span><span class=\"n\">lat</span><span class=\"p\">,</span> <span class=\"n\">lng</span><span class=\"o\">=</span><span class=\"n\">lng</span><span class=\"p\">,</span> <span class=\"n\">start_date_written</span><span class=\"o\">=</span><span class=\"n\">foundation</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">latLong</span><span class=\"p\">:</span>\n        <span class=\"n\">place</span><span class=\"o\">.</span><span class=\"n\">status</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;distinct&#39;</span>\n    <span class=\"n\">place</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">def_coll</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">Collection</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Default import collection&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">place</span><span class=\"o\">.</span><span class=\"n\">collection</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">def_coll</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">place</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">loaded</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">loaded_time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">now</span><span class=\"p\">()</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">label</span> <span class=\"ow\">in</span> <span class=\"n\">labels</span><span class=\"p\">:</span>\n        <span class=\"n\">lType</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">LabelType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;alternative name&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">label</span><span class=\"p\">,</span> <span class=\"n\">label_type</span><span class=\"o\">=</span><span class=\"n\">lType</span><span class=\"p\">,</span> <span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">)</span>\n        <span class=\"n\">l</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">uri3</span> <span class=\"ow\">in</span> <span class=\"n\">geonames</span><span class=\"p\">:</span>\n        <span class=\"n\">match</span> <span class=\"o\">=</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">search</span><span class=\"p\">(</span><span class=\"s1\">r&#39;//([^/]+)&#39;</span><span class=\"p\">,</span> <span class=\"n\">uri3</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">match</span><span class=\"p\">:</span>\n            <span class=\"n\">domain</span> <span class=\"o\">=</span> <span class=\"n\">match</span><span class=\"o\">.</span><span class=\"n\">group</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">domain</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"n\">uri4</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">uri3</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"n\">domain</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">place</span><span class=\"p\">)</span>\n        <span class=\"n\">uri4</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">place</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">gndInstitution</span><span class=\"p\">(</span><span class=\"n\">txt</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">)</span>\n    <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">Graph</span><span class=\"p\">()</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"n\">txt</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;/about/rdf&#39;</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;xml&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s1\">&#39;http://d-nb.info/gnd/&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">instName</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">foundation</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">termination</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">prec_inst</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">suc_inst</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">superior_inst</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">homepage</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">for</span> <span class=\"n\">subj</span><span class=\"p\">,</span> <span class=\"n\">pred</span><span class=\"p\">,</span> <span class=\"n\">obj</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#preferredNameForTheCorporateBody&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">instName</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#variantNameForTheCorporateBody&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">labels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#placeOfBusiness&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">get_or_create_uri</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">))</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">p</span><span class=\"p\">:</span>\n                <span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"n\">gndPlace</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#hierarchicalSuperiorOfTheCorporateBody&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">superior_inst2</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"n\">superior_inst2</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">get_or_create_uri</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">superior_inst2</span> <span class=\"ow\">and</span> <span class=\"n\">drill_down</span><span class=\"p\">:</span>\n                <span class=\"n\">superior_inst2</span> <span class=\"o\">=</span> <span class=\"n\">gndInstitution</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">superior_inst2</span><span class=\"p\">:</span>\n                <span class=\"n\">superior_inst</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">superior_inst2</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#precedingCorporateBody&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">prec_inst2</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"n\">prec_inst2</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">get_or_create_uri</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">prec_inst2</span> <span class=\"ow\">and</span> <span class=\"n\">drill_down</span><span class=\"p\">:</span>\n                <span class=\"n\">prec_inst2</span> <span class=\"o\">=</span> <span class=\"n\">gndInstitution</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">prec_inst2</span><span class=\"p\">:</span>\n                <span class=\"n\">prec_inst</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">prec_inst2</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#succeedingCorporateBody&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">suc_inst2</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"n\">suc_inst2</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">get_or_create_uri</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">suc_inst2</span> <span class=\"ow\">and</span> <span class=\"n\">drill_down</span><span class=\"p\">:</span>\n                <span class=\"n\">suc_inst2</span> <span class=\"o\">=</span> <span class=\"n\">gndInstitution</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">suc_inst2</span><span class=\"p\">:</span>\n                <span class=\"n\">suc_inst</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">suc_inst2</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#dateOfEstablishment&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">foundation</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#dateOfTermination&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">termination</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#homepage&#39;</span><span class=\"p\">:</span>\n            <span class=\"n\">homepage</span> <span class=\"o\">=</span> <span class=\"n\">obj</span>\n    <span class=\"n\">inst</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">instName</span><span class=\"p\">,</span> <span class=\"n\">start_date_written</span><span class=\"o\">=</span><span class=\"n\">foundation</span><span class=\"p\">,</span>\n        <span class=\"n\">end_date_written</span><span class=\"o\">=</span><span class=\"n\">termination</span><span class=\"p\">,</span> <span class=\"n\">homepage</span><span class=\"o\">=</span><span class=\"n\">homepage</span><span class=\"p\">)</span>\n    <span class=\"n\">inst</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">def_coll</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">Collection</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Default import collection&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">inst</span><span class=\"o\">.</span><span class=\"n\">collection</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">def_coll</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">inst</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">loaded</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">loaded_time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">now</span><span class=\"p\">()</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">p</span><span class=\"p\">:</span>\n        <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionPlaceRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;situated in&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">instplace</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionPlace</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">related_institution</span><span class=\"o\">=</span><span class=\"n\">inst</span><span class=\"p\">,</span> <span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">p</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">label</span> <span class=\"ow\">in</span> <span class=\"n\">labels</span><span class=\"p\">:</span>\n        <span class=\"n\">lType</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">LabelType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;alternative name&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">l</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">label</span><span class=\"p\">,</span> <span class=\"n\">label_type</span><span class=\"o\">=</span><span class=\"n\">lType</span><span class=\"p\">,</span> <span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n        <span class=\"n\">l</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">s</span> <span class=\"ow\">in</span> <span class=\"n\">superior_inst</span><span class=\"p\">:</span>\n        <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitutionRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;is superior of&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">instinst</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitution</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">related_institutionA</span><span class=\"o\">=</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">related_institutionB</span><span class=\"o\">=</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">s</span> <span class=\"ow\">in</span> <span class=\"n\">prec_inst</span><span class=\"p\">:</span>\n        <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitutionRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;is preceding&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">instinst</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitution</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">related_institutionA</span><span class=\"o\">=</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">related_institutionB</span><span class=\"o\">=</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">s</span> <span class=\"ow\">in</span> <span class=\"n\">suc_inst</span><span class=\"p\">:</span>\n        <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitutionRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;is succeeding&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">instinst</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitution</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">related_institutionA</span><span class=\"o\">=</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">related_institutionB</span><span class=\"o\">=</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">inst</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">gndPerson</span><span class=\"p\">(</span><span class=\"n\">txt</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">Person</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">Person</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">)</span>\n    <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">Graph</span><span class=\"p\">()</span>\n    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"n\">txt</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;/about/rdf&#39;</span><span class=\"p\">,</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;xml&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">txt</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s1\">&#39;http://d-nb.info/gnd/&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">uris</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">family_members</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">friends</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">publications</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">professions</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">affiliations</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"n\">forename</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">surname</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">placeBirth</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">placeDeath</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">dateBirth</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">dateDeath</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">o</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">txt</span><span class=\"p\">)</span>\n    <span class=\"n\">pref_name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span>\n        <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#preferredNameEntityForThePerson&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">pref_name_2</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span>\n        <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#preferredNameForThePerson&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">pref_node</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">pref_name</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">forename_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#forename&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">surname_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#surname&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">variant_name</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span>\n        <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#variantNameForThePerson&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">family_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#familialRelationship&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">friend_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span>\n        <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#acquaintanceshipOrFriendship&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">placeBirth_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#placeOfBirth&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">placeDeath_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#placeOfDeath&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">dateBirth_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#dateOfBirth&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">dateDeath_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#dateOfDeath&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">gender_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#gender&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">publication_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#publication&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">bio_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span>\n        <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#biographicalOrHistoricalInformation&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">profession_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span>\n        <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#professionOrOccupation&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">sub_head_t</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span>\n        <span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#preferredNameForTheSubjectHeading&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">affiliation</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"s1\">&#39;http://d-nb.info/standards/elementset/gnd#affiliation&#39;</span><span class=\"p\">)</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">forename</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">pref_node</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">forename_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n        <span class=\"n\">surname</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">pref_node</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">surname_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n    <span class=\"k\">except</span><span class=\"p\">:</span>\n        <span class=\"n\">forename</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"n\">surname</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">variant_name</span><span class=\"p\">):</span>\n        <span class=\"n\">labels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">uri</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">OWL</span><span class=\"o\">.</span><span class=\"n\">sameAs</span><span class=\"p\">):</span>\n        <span class=\"n\">uris</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">placeBirth_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">placeBirth</span> <span class=\"o\">=</span> <span class=\"n\">gndPlace</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">placeBirth_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)))</span>\n    <span class=\"k\">if</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">placeDeath_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">placeDeath</span> <span class=\"o\">=</span> <span class=\"n\">gndPlace</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">placeDeath_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)))</span>\n    <span class=\"n\">dateBirth</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">dateBirth_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">dateDeath</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">dateDeath_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">gender_1</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">gender_t</span><span class=\"p\">,</span> <span class=\"nb\">object</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">gender_1</span><span class=\"p\">:</span>\n        <span class=\"n\">gender</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">gender_1</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s1\">&#39;#&#39;</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n    <span class=\"n\">pers</span> <span class=\"o\">=</span> <span class=\"n\">Person</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">surname</span><span class=\"p\">,</span> <span class=\"n\">first_name</span><span class=\"o\">=</span><span class=\"n\">forename</span><span class=\"p\">,</span> <span class=\"n\">start_date_written</span><span class=\"o\">=</span><span class=\"n\">dateBirth</span><span class=\"p\">,</span>\n        <span class=\"n\">end_date_written</span><span class=\"o\">=</span><span class=\"n\">dateDeath</span><span class=\"p\">,</span> <span class=\"n\">gender</span><span class=\"o\">=</span><span class=\"n\">gender</span><span class=\"p\">)</span>\n    <span class=\"n\">pers</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">def_coll</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">Collection</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Default import collection&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">pers</span><span class=\"o\">.</span><span class=\"n\">collection</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">def_coll</span><span class=\"p\">)</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">pers</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">loaded</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">loaded_time</span> <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"o\">.</span><span class=\"n\">now</span><span class=\"p\">()</span>\n    <span class=\"n\">uri2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">fam</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">family_t</span><span class=\"p\">):</span>\n        <span class=\"n\">memb</span> <span class=\"o\">=</span> <span class=\"n\">Person</span><span class=\"o\">.</span><span class=\"n\">get_or_create_uri</span><span class=\"p\">(</span><span class=\"n\">fam</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">drill_down</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">memb</span><span class=\"p\">:</span>\n            <span class=\"n\">memb</span> <span class=\"o\">=</span> <span class=\"n\">gndPerson</span><span class=\"p\">(</span><span class=\"n\">fam</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n            <span class=\"n\">family_members</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">memb</span><span class=\"p\">)</span>\n        <span class=\"c1\"># elif not memb:</span>\n        <span class=\"c1\">#     memb = g.value(subject=fam, predicate=pref_name_2, object=None)</span>\n        <span class=\"c1\">#     m_last_name, m_forename = memb.split(&#39;,&#39;)</span>\n        <span class=\"c1\">#     memb2 = Person(name=m_last_name.strip(), first_name=m_forename.strip())</span>\n        <span class=\"c1\">#     memb2.save()</span>\n        <span class=\"c1\">#     memb_uri = genUri(uri=fam, domain=&#39;http://d-nb.info/gnd/&#39;, entity=memb2)</span>\n        <span class=\"c1\">#     memb_uri.save()</span>\n        <span class=\"c1\">#     family_members.append(memb2)</span>\n        <span class=\"k\">elif</span> <span class=\"n\">memb</span><span class=\"p\">:</span>\n            <span class=\"n\">family_members</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">memb</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">friend</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">friend_t</span><span class=\"p\">):</span>\n        <span class=\"n\">memb</span> <span class=\"o\">=</span> <span class=\"n\">Person</span><span class=\"o\">.</span><span class=\"n\">get_or_create_uri</span><span class=\"p\">(</span><span class=\"n\">friend</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">drill_down</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">memb</span><span class=\"p\">:</span>\n            <span class=\"n\">memb</span> <span class=\"o\">=</span> <span class=\"n\">gndPerson</span><span class=\"p\">(</span><span class=\"n\">friend</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n            <span class=\"n\">friends</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">memb</span><span class=\"p\">)</span>\n        <span class=\"c1\"># elif not memb:</span>\n        <span class=\"c1\">#     memb = g.value(subject=friend, predicate=pref_name_2, object=None)</span>\n        <span class=\"c1\">#     m_last_name, m_forename = memb.split(&#39;,&#39;)</span>\n        <span class=\"c1\">#     memb2 = Person(name=m_last_name.strip(), first_name=m_forename.strip())</span>\n        <span class=\"c1\">#     memb2.save()</span>\n        <span class=\"c1\">#     memb_uri = genUri(uri=friend, domain=&#39;http://d-nb.info/gnd/&#39;, entity=memb2)</span>\n        <span class=\"c1\">#     memb_uri.save()</span>\n        <span class=\"c1\">#     friends.append(memb2)</span>\n        <span class=\"k\">elif</span> <span class=\"n\">memb</span><span class=\"p\">:</span>\n            <span class=\"n\">friends</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">memb</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">affil</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">affiliation</span><span class=\"p\">):</span>\n        <span class=\"n\">inst</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">get_or_create_uri</span><span class=\"p\">(</span><span class=\"n\">affil</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">drill_down</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">inst</span><span class=\"p\">:</span>\n            <span class=\"n\">inst</span> <span class=\"o\">=</span> <span class=\"n\">gndInstitution</span><span class=\"p\">(</span><span class=\"n\">affil</span><span class=\"p\">,</span> <span class=\"n\">drill_down</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n            <span class=\"n\">affiliations</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"ow\">not</span> <span class=\"n\">inst</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">pred</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">predicates</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">affil</span><span class=\"p\">):</span>\n                <span class=\"k\">if</span> <span class=\"s1\">&#39;preferredName&#39;</span> <span class=\"ow\">in</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pred</span><span class=\"p\">):</span>\n                    <span class=\"n\">inst</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">affiliation</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">pred</span><span class=\"p\">)</span>\n                    <span class=\"n\">inst2</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n                    <span class=\"n\">inst2</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n                    <span class=\"n\">inst_uri</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">affil</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"o\">=</span><span class=\"s1\">&#39;http://d-nb.info/gnd/&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">inst2</span><span class=\"p\">)</span>\n                    <span class=\"n\">inst_uri</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n                    <span class=\"n\">affiliations</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">inst2</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">affiliations</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">inst</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">pub</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">publication_t</span><span class=\"p\">):</span>\n        <span class=\"n\">pub_t</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">WorkType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Publikation&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">w</span> <span class=\"o\">=</span> <span class=\"n\">Work</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pub</span><span class=\"p\">),</span> <span class=\"n\">kind</span><span class=\"o\">=</span><span class=\"n\">pub_t</span><span class=\"p\">)</span>\n        <span class=\"n\">w</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">publications</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">w</span><span class=\"p\">)</span>\n    <span class=\"c1\"># for prof in g.objects(subject=o, predicate=profession_t):</span>\n    <span class=\"c1\">#     name_prof = g.value(subject=prof, predicate=sub_head_t, object=None)</span>\n    <span class=\"c1\">#     if ProfessionType.objects.filter(vocabsuri__uri=prof).count() == 1:</span>\n    <span class=\"c1\">#         profession = ProfessionType.objects.get(vocabsuri__uri=prof)</span>\n    <span class=\"c1\">#     elif ProfessionType.objects.filter(vocabsuri__uri=prof).count() == 0:</span>\n    <span class=\"c1\">#         profession = ProfessionType(name=name_prof)</span>\n    <span class=\"c1\">#         profession.save()</span>\n    <span class=\"c1\">#         uri3 = VocabsUri(uri=prof, domain=&#39;http://d-nb.info/gnd/&#39;, vocab=profession)</span>\n    <span class=\"c1\">#         uri3.save()</span>\n    <span class=\"c1\">#     professions.append(profession)</span>\n    <span class=\"n\">fam_relation</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PersonPersonRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;family member&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">friend_relation</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PersonPersonRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;friend&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">publication_relation</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PersonWorkRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;author&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">pl_birth_realtion</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlaceRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;place of birth&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">pl_death_realtion</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlaceRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;place of death&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">affiliation_relation</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">PersonInstitutionRelation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;affiliation&#39;</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">placeBirth</span><span class=\"p\">:</span>\n        <span class=\"n\">plBirth</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlace</span><span class=\"p\">(</span>\n            <span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">pers</span><span class=\"p\">,</span> <span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">placeBirth</span><span class=\"p\">,</span> <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">pl_birth_realtion</span><span class=\"p\">)</span>\n        <span class=\"n\">plBirth</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">if</span> <span class=\"n\">placeDeath</span><span class=\"p\">:</span>\n        <span class=\"n\">plDeath</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlace</span><span class=\"p\">(</span>\n            <span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">pers</span><span class=\"p\">,</span> <span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">placeDeath</span><span class=\"p\">,</span> <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">pl_death_realtion</span><span class=\"p\">)</span>\n        <span class=\"n\">plDeath</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">prof</span> <span class=\"ow\">in</span> <span class=\"n\">professions</span><span class=\"p\">:</span>\n        <span class=\"n\">pers</span><span class=\"o\">.</span><span class=\"n\">profession</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">prof</span><span class=\"p\">)</span>\n    <span class=\"k\">for</span> <span class=\"n\">fam</span> <span class=\"ow\">in</span> <span class=\"n\">family_members</span><span class=\"p\">:</span>\n        <span class=\"n\">perspers</span> <span class=\"o\">=</span> <span class=\"n\">PersonPerson</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">fam_relation</span><span class=\"p\">,</span> <span class=\"n\">related_personA</span><span class=\"o\">=</span><span class=\"n\">pers</span><span class=\"p\">,</span> <span class=\"n\">related_personB</span><span class=\"o\">=</span><span class=\"n\">fam</span><span class=\"p\">)</span>\n        <span class=\"n\">perspers</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">fr</span> <span class=\"ow\">in</span> <span class=\"n\">friends</span><span class=\"p\">:</span>\n        <span class=\"n\">perspers</span> <span class=\"o\">=</span> <span class=\"n\">PersonPerson</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">friend_relation</span><span class=\"p\">,</span> <span class=\"n\">related_personA</span><span class=\"o\">=</span><span class=\"n\">pers</span><span class=\"p\">,</span> <span class=\"n\">related_personB</span><span class=\"o\">=</span><span class=\"n\">fr</span><span class=\"p\">)</span>\n        <span class=\"n\">perspers</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">pub</span> <span class=\"ow\">in</span> <span class=\"n\">publications</span><span class=\"p\">:</span>\n        <span class=\"n\">perspub</span> <span class=\"o\">=</span> <span class=\"n\">PersonWork</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">publication_relation</span><span class=\"p\">,</span> <span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">pers</span><span class=\"p\">,</span> <span class=\"n\">related_work</span><span class=\"o\">=</span><span class=\"n\">pub</span><span class=\"p\">)</span>\n        <span class=\"n\">perspub</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"k\">for</span> <span class=\"n\">affil</span> <span class=\"ow\">in</span> <span class=\"n\">affiliations</span><span class=\"p\">:</span>\n        <span class=\"n\">persinst</span> <span class=\"o\">=</span> <span class=\"n\">PersonInstitution</span><span class=\"p\">(</span>\n            <span class=\"n\">relation_type</span><span class=\"o\">=</span><span class=\"n\">affiliation_relation</span><span class=\"p\">,</span> <span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">pers</span><span class=\"p\">,</span> <span class=\"n\">related_institution</span><span class=\"o\">=</span><span class=\"n\">affil</span><span class=\"p\">)</span>\n        <span class=\"n\">persinst</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">pers</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">PlaceUri</span><span class=\"p\">:</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">uri</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"s1\">&#39;http://sws.geonames.org/&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">uri</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">geonamesPlace</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"s1\">&#39;http://d-nb.info/gnd/&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">uri</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">place</span> <span class=\"o\">=</span> <span class=\"n\">gndPlace</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">GenericRDFParser_depricated</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"c1\">#     def find_name(tupl):</span>\n    <span class=\"c1\">#         while type(tupl) == tuple:</span>\n    <span class=\"c1\">#             tupl = tupl[]</span>\n    <span class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">uri</span><span class=\"p\">,</span> <span class=\"n\">kind</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"k\">def</span> <span class=\"nf\">exist</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"kc\">False</span>\n\n        <span class=\"k\">def</span> <span class=\"nf\">prep_string</span><span class=\"p\">(</span><span class=\"n\">tupl</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">tupl</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"n\">tupl</span>\n            <span class=\"k\">if</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">])[</span><span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]]</span>\n                <span class=\"k\">except</span><span class=\"p\">:</span>\n                    <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"k\">return</span> <span class=\"n\">r</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span>\n        <span class=\"n\">objct</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s2\">&quot;entities&quot;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">kind</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()</span>\n        <span class=\"n\">force</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;force&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">test</span> <span class=\"o\">=</span> <span class=\"n\">exist</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">uri</span> <span class=\"o\">=</span> <span class=\"n\">uri</span>\n        <span class=\"k\">if</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">force</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span> <span class=\"o\">=</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;did not pass test&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;passeed test&#39;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"n\">rdf_t</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n            <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;data&#39;</span><span class=\"p\">]:</span>\n                <span class=\"n\">res_objct</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">uri</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s1\">&#39;base_url&#39;</span><span class=\"p\">]):</span>\n                    <span class=\"k\">continue</span>\n                <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">Graph</span><span class=\"p\">()</span>\n                <span class=\"n\">uri_2</span> <span class=\"o\">=</span> <span class=\"n\">uri</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">uri_2</span><span class=\"o\">.</span><span class=\"n\">endswith</span><span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">):</span>\n                    <span class=\"n\">uri_2</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;/&#39;</span>\n                <span class=\"n\">o2</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n                <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"si\">{}{}</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">uri_2</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">(),</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s1\">&#39;url_appendix&#39;</span><span class=\"p\">]),</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;xml&#39;</span><span class=\"p\">)</span>\n\n                <span class=\"k\">for</span> <span class=\"n\">xx</span> <span class=\"ow\">in</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s1\">&#39;attributes&#39;</span><span class=\"p\">]:</span>\n                    <span class=\"n\">rdf_t</span><span class=\"p\">[</span><span class=\"n\">xx</span><span class=\"p\">[</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n                    <span class=\"n\">subj2</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                    <span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                    <span class=\"k\">for</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"n\">xx</span><span class=\"p\">[</span><span class=\"s1\">&#39;identifiers&#39;</span><span class=\"p\">]:</span>\n                        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">results</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                            <span class=\"k\">continue</span>\n                        <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n                        <span class=\"n\">cnt_2</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n                        <span class=\"k\">try</span><span class=\"p\">:</span>\n                            <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt_2</span><span class=\"p\">]</span>\n                        <span class=\"k\">except</span><span class=\"p\">:</span>\n                            <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;=&#39;</span>\n                        <span class=\"n\">subj</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"p\">]</span>\n                        <span class=\"k\">while</span> <span class=\"n\">k</span><span class=\"p\">:</span>\n                            <span class=\"k\">for</span> <span class=\"n\">indx</span><span class=\"p\">,</span> <span class=\"n\">s</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">subj</span><span class=\"p\">):</span>\n                                <span class=\"k\">if</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;objects&#39;</span><span class=\"p\">:</span>\n                                    <span class=\"n\">pred</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">2</span><span class=\"p\">])</span>\n                                    <span class=\"n\">res</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">pred</span><span class=\"p\">)</span>\n                                    <span class=\"k\">if</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">)</span> <span class=\"o\">!=</span> <span class=\"n\">types</span><span class=\"o\">.</span><span class=\"n\">GeneratorType</span><span class=\"p\">:</span>\n                                        <span class=\"k\">break</span>\n                                    <span class=\"k\">for</span> <span class=\"n\">r</span> <span class=\"ow\">in</span> <span class=\"n\">res</span><span class=\"p\">:</span>\n                                        <span class=\"k\">if</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">3</span><span class=\"p\">]:</span>\n                                            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">3</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"o\">==</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">3</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n                                                <span class=\"k\">continue</span>\n                                        <span class=\"k\">if</span> <span class=\"n\">k</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;&gt;&#39;</span><span class=\"p\">:</span>\n                                            <span class=\"n\">subj2</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n                                        <span class=\"k\">elif</span> <span class=\"n\">k</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;=&#39;</span><span class=\"p\">:</span>\n                                            <span class=\"n\">results</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">((</span><span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">],</span> <span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">indx</span><span class=\"p\">))</span>\n                            <span class=\"n\">cnt_2</span> <span class=\"o\">+=</span> <span class=\"mi\">2</span>\n                            <span class=\"k\">try</span><span class=\"p\">:</span>\n                                <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt_2</span><span class=\"p\">]</span>\n                            <span class=\"k\">except</span><span class=\"p\">:</span>\n                                <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;=&#39;</span>\n                            <span class=\"k\">if</span> <span class=\"n\">cnt</span> <span class=\"o\">+</span> <span class=\"mi\">2</span> <span class=\"o\">&gt;</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">z</span><span class=\"p\">):</span>\n                                <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n                            <span class=\"n\">cnt</span> <span class=\"o\">+=</span> <span class=\"mi\">2</span>\n                            <span class=\"n\">subj</span> <span class=\"o\">=</span> <span class=\"n\">subj2</span>\n                    <span class=\"k\">for</span> <span class=\"n\">m</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;matching&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n                        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"s1\">&#39;results: </span><span class=\"si\">{}</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">results</span><span class=\"p\">))</span>\n                        <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                        <span class=\"n\">label_type_alt</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">LabelType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;alternative name&#39;</span><span class=\"p\">)</span>\n                        <span class=\"n\">res</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">]</span>\n                        <span class=\"n\">lst_keys</span> <span class=\"o\">=</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;matching&#39;</span><span class=\"p\">][</span><span class=\"n\">m</span><span class=\"p\">]</span>\n                        <span class=\"n\">kind_match</span> <span class=\"o\">=</span> <span class=\"n\">lst_keys</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n                        <span class=\"k\">for</span> <span class=\"n\">mm</span> <span class=\"ow\">in</span> <span class=\"n\">lst_keys</span><span class=\"p\">:</span>\n                            <span class=\"n\">res2</span> <span class=\"o\">=</span> <span class=\"p\">[[],</span> <span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]]</span>\n                            <span class=\"k\">for</span> <span class=\"n\">mmm</span> <span class=\"ow\">in</span> <span class=\"n\">mm</span><span class=\"p\">:</span>\n                                <span class=\"n\">str_res</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n                                <span class=\"k\">for</span> <span class=\"n\">r</span> <span class=\"ow\">in</span> <span class=\"n\">results</span><span class=\"p\">:</span>\n                                    <span class=\"c1\">#print(&#39;{} - {}: {}&#39;.format(r[0], mmm[0], r[1]))</span>\n                                    <span class=\"k\">try</span><span class=\"p\">:</span>\n                                        <span class=\"k\">if</span> <span class=\"n\">r</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">mmm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">and</span> <span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">r</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]):</span>\n                                            <span class=\"k\">if</span> <span class=\"n\">kind_match</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;string&#39;</span><span class=\"p\">:</span>\n                                                <span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">prep_string</span><span class=\"p\">((</span><span class=\"n\">r</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">toPython</span><span class=\"p\">(),</span> <span class=\"n\">mmm</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])))</span>\n                                            <span class=\"k\">elif</span> <span class=\"n\">kind_match</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;label&#39;</span><span class=\"p\">:</span>\n                                                <span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n                                                <span class=\"k\">break</span>\n                                            <span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">r</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span>\n                                            <span class=\"k\">if</span> <span class=\"n\">kind_match</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;string&#39;</span><span class=\"p\">:</span>\n                                                <span class=\"k\">break</span>\n                                        <span class=\"k\">elif</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">mmm</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span> <span class=\"c1\"># TODO: The possibility to set default strings in the matching settings is not used so far</span>\n                                            <span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">mmm</span><span class=\"p\">)</span>\n                                            <span class=\"k\">break</span>\n                                        <span class=\"k\">elif</span> <span class=\"n\">r</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">mmm</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">and</span> <span class=\"n\">kind_match</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;label&#39;</span><span class=\"p\">:</span>\n                                            <span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n                                            <span class=\"k\">break</span>\n                                    <span class=\"k\">except</span> <span class=\"ne\">Exception</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n                                        <span class=\"c1\">#print(e)</span>\n                                        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">mmm</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                                            <span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">mmm</span><span class=\"p\">)</span>\n                                            <span class=\"k\">break</span>\n                            <span class=\"k\">if</span> <span class=\"n\">kind_match</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;string&#39;</span><span class=\"p\">:</span>\n                                <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"o\">==</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">mm</span><span class=\"p\">):</span>\n                                    <span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n                                <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                                    <span class=\"n\">res_objct</span><span class=\"p\">[</span><span class=\"n\">m</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">res</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n                            <span class=\"k\">if</span> <span class=\"n\">kind_match</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;label&#39;</span><span class=\"p\">:</span>\n                                <span class=\"k\">for</span> <span class=\"n\">r</span> <span class=\"ow\">in</span> <span class=\"n\">res2</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]:</span>\n                                    <span class=\"c1\">#print(&#39;run through labels&#39;)</span>\n                                    <span class=\"n\">lang</span> <span class=\"o\">=</span> <span class=\"n\">r</span><span class=\"o\">.</span><span class=\"n\">lang</span>\n                                    <span class=\"n\">strng</span> <span class=\"o\">=</span> <span class=\"n\">r</span><span class=\"o\">.</span><span class=\"n\">toPython</span><span class=\"p\">()</span>\n                                    <span class=\"n\">labels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">Label</span><span class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">strng</span><span class=\"p\">,</span> <span class=\"n\">isoCode_639_3</span><span class=\"o\">=</span><span class=\"n\">lang</span><span class=\"p\">,</span> <span class=\"n\">label_type</span><span class=\"o\">=</span><span class=\"n\">label_type_alt</span><span class=\"p\">))</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span> <span class=\"o\">=</span> <span class=\"n\">objct</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">res_objct</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"n\">labels</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">labels</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"GenericRDFParser\"><a class=\"viewcode-back\" href=\"../../../modules/helper_functions/#helper_functions.RDFparsers.GenericRDFParser\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">GenericRDFParser</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;A generic class for parsing RDFs to the APIS data model and save</span>\n<span class=\"sd\">    objects to the db.</span>\n\n<span class=\"sd\">    Attributes:</span>\n\n<span class=\"sd\">    - self.objct: (object) the object created by the parser</span>\n\n<span class=\"sd\">    - self.labels: (list) list of labels created by the parser (only saved when self.save() is called)</span>\n\n<span class=\"sd\">    - self.related_objcts: (list) list of related objects (relations) (only saved when self.save() is called)</span>\n\n<span class=\"sd\">    - self.kind: (string) kind of entity of the object (Persion, Place, Institution, Work, Event)</span>\n\n<span class=\"sd\">    - self.uri: (string) uri provided when initializing the object</span>\n\n<span class=\"sd\">    - self.saved: (boolean) indicates whether the object was saved to the db</span>\n\n<span class=\"sd\">    - self.created: (boolean) indicates whether the object was created</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n<div class=\"viewcode-block\" id=\"GenericRDFParser.save\"><a class=\"viewcode-back\" href=\"../../../modules/helper_functions/#helper_functions.RDFparsers.GenericRDFParser.save\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">save</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        :return: django object saved to db or False if nothing was saved</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"n\">def_coll</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">Collection</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;Default import collection&#39;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">collection</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">def_coll</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">saved</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n        <span class=\"k\">for</span> <span class=\"n\">lab</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">labels</span><span class=\"p\">:</span>\n            <span class=\"n\">lab</span><span class=\"o\">.</span><span class=\"n\">temp_entity</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span>\n            <span class=\"n\">lab</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">obj</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">related_objcts</span><span class=\"p\">:</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"s1\">&#39;related_&#39;</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s1\">&#39;_id&#39;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n            <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span></div>\n\n<div class=\"viewcode-block\" id=\"GenericRDFParser.merge\"><a class=\"viewcode-back\" href=\"../../../modules/helper_functions/#helper_functions.RDFparsers.GenericRDFParser.merge\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">merge</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">m_obj</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        :param m_obj: the object to merge with (must be an django model object instance)</span>\n<span class=\"sd\">        :return: django object saved to db or False if nothing was saved</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">saved</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">rel</span> <span class=\"ow\">in</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s1\">&#39;relations&#39;</span><span class=\"p\">,</span> <span class=\"n\">model__icontains</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"p\">):</span>\n                <span class=\"n\">rel_q</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;related_&#39;</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">():</span> <span class=\"n\">m_obj</span><span class=\"p\">}</span>\n                <span class=\"n\">rel2</span> <span class=\"o\">=</span> <span class=\"n\">rel</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"k\">for</span> <span class=\"n\">rel_exst</span> <span class=\"ow\">in</span> <span class=\"n\">rel2</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">rel_q</span><span class=\"p\">):</span>\n                        <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"n\">rel_exst</span><span class=\"p\">,</span> <span class=\"s1\">&#39;related_&#39;</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s1\">&#39;_id&#39;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n                        <span class=\"n\">rel_exst</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n                <span class=\"k\">except</span> <span class=\"n\">FieldError</span><span class=\"p\">:</span>  <span class=\"c1\"># e.g. PlacePlace relations have different related_ fields</span>\n                    <span class=\"n\">rel_q</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;related_&#39;</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s1\">&#39;A&#39;</span><span class=\"p\">:</span> <span class=\"n\">m_obj</span><span class=\"p\">}</span>\n                    <span class=\"k\">for</span> <span class=\"n\">rel_exst</span> <span class=\"ow\">in</span> <span class=\"n\">rel2</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">rel_q</span><span class=\"p\">):</span>\n                        <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"n\">rel_exst</span><span class=\"p\">,</span> <span class=\"s1\">&#39;related_&#39;</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s1\">&#39;A_id&#39;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n                        <span class=\"n\">rel_exst</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n                    <span class=\"n\">rel_q</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;related_&#39;</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"s1\">&#39;B&#39;</span><span class=\"p\">:</span> <span class=\"n\">m_obj</span><span class=\"p\">}</span>\n                    <span class=\"k\">for</span> <span class=\"n\">rel_exst</span> <span class=\"ow\">in</span> <span class=\"n\">rel2</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">rel_q</span><span class=\"p\">):</span>\n                        <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"n\">rel_exst</span><span class=\"p\">,</span> <span class=\"s1\">&#39;related_&#39;</span><span class=\"o\">+</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s1\">&#39;B_id&#39;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n                        <span class=\"n\">rel_exst</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">False</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span></div>\n\n<div class=\"viewcode-block\" id=\"GenericRDFParser.get_or_create\"><a class=\"viewcode-back\" href=\"../../../modules/helper_functions/#helper_functions.RDFparsers.GenericRDFParser.get_or_create\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_or_create</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        :return: Returns the parsed object. Saves it to the db when needed</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">saved</span><span class=\"p\">:</span>\n                <span class=\"n\">ob</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n                <span class=\"k\">return</span> <span class=\"n\">ob</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">uri</span><span class=\"p\">,</span> <span class=\"n\">kind</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        :param uri: (url) Uri to parse the object from (http://test.at). The uri must start with a base url mentioned in the RDF parser settings file.</span>\n<span class=\"sd\">        :param kind: (string) Kind of entity (Person, Place, Institution, Work, Event)</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">owl</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;http://www.w3.org/2002/07/owl#&quot;</span>\n\n        <span class=\"k\">def</span> <span class=\"nf\">exist</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">uri__uri</span><span class=\"o\">=</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"kc\">False</span>\n\n        <span class=\"k\">def</span> <span class=\"nf\">prep_string</span><span class=\"p\">(</span><span class=\"n\">tupl</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">tupl</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"n\">tupl</span>\n            <span class=\"k\">if</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n                <span class=\"n\">m</span> <span class=\"o\">=</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">match</span><span class=\"p\">(</span><span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n                <span class=\"n\">group</span> <span class=\"o\">=</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">group</span><span class=\"p\">:</span>\n                    <span class=\"n\">group</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"k\">return</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">group</span><span class=\"p\">(</span><span class=\"n\">group</span><span class=\"p\">)</span>\n                <span class=\"k\">except</span><span class=\"p\">:</span>\n                    <span class=\"k\">return</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">tupl</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"k\">return</span> <span class=\"n\">r</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">()</span>\n        <span class=\"n\">objct</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s2\">&quot;entities&quot;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">kind</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()</span>\n        <span class=\"n\">force</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;force&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">res_attrb</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n        <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">related_objcts</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">test</span> <span class=\"o\">=</span> <span class=\"n\">exist</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">uri</span> <span class=\"o\">=</span> <span class=\"n\">uri</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">kind</span> <span class=\"o\">=</span> <span class=\"n\">kind</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">saved</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"k\">if</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">force</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span> <span class=\"o\">=</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"n\">rdf_t</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n            <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;data&#39;</span><span class=\"p\">]:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">settings_defined</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">uri</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s1\">&#39;base_url&#39;</span><span class=\"p\">]):</span>\n                    <span class=\"k\">continue</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">settings_defined</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n                <span class=\"n\">g</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">Graph</span><span class=\"p\">()</span>\n                <span class=\"n\">uri_2</span> <span class=\"o\">=</span> <span class=\"n\">uri</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">uri_2</span><span class=\"o\">.</span><span class=\"n\">endswith</span><span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">):</span>\n                    <span class=\"n\">uri_2</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;/&#39;</span>\n                <span class=\"n\">o2</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n                <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"si\">{}{}</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">uri_2</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">(),</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s1\">&#39;url_appendix&#39;</span><span class=\"p\">]),</span> <span class=\"nb\">format</span><span class=\"o\">=</span><span class=\"s1\">&#39;xml&#39;</span><span class=\"p\">)</span>\n                <span class=\"n\">sameas</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">owl</span><span class=\"o\">+</span><span class=\"s1\">&#39;sameAs&#39;</span><span class=\"p\">)</span>\n                <span class=\"n\">list_sameas</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sameas</span> <span class=\"o\">=</span> <span class=\"n\">list_sameas</span>\n                <span class=\"k\">for</span> <span class=\"n\">p</span> <span class=\"ow\">in</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">sameas</span><span class=\"p\">):</span>\n                    <span class=\"n\">list_sameas</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">p</span><span class=\"p\">))</span>\n                <span class=\"k\">for</span> <span class=\"n\">uri_2</span> <span class=\"ow\">in</span> <span class=\"n\">list_sameas</span><span class=\"p\">:</span>\n                    <span class=\"n\">test</span> <span class=\"o\">=</span> <span class=\"n\">exist</span><span class=\"p\">(</span><span class=\"n\">uri_2</span><span class=\"p\">)</span>\n                    <span class=\"k\">if</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]:</span>\n                        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span> <span class=\"o\">=</span> <span class=\"n\">test</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n                        <span class=\"n\">uri_3</span> <span class=\"o\">=</span> <span class=\"n\">genUri</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"o\">=</span><span class=\"n\">uri_2</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"p\">)</span>\n                        <span class=\"n\">uri_3</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n                <span class=\"k\">for</span> <span class=\"n\">xx</span> <span class=\"ow\">in</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s1\">&#39;attributes&#39;</span><span class=\"p\">]:</span>\n                    <span class=\"n\">rdf_t</span><span class=\"p\">[</span><span class=\"n\">xx</span><span class=\"p\">[</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">]]</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n                    <span class=\"n\">subj2</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                    <span class=\"n\">results</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                    <span class=\"n\">ind_type</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n                    <span class=\"k\">for</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"n\">xx</span><span class=\"p\">[</span><span class=\"s1\">&#39;identifiers&#39;</span><span class=\"p\">]:</span>\n                        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">results</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                            <span class=\"k\">continue</span>\n                        <span class=\"n\">cnt</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n                        <span class=\"n\">cnt_2</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n                        <span class=\"k\">try</span><span class=\"p\">:</span>\n                            <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt_2</span><span class=\"p\">]</span>\n                        <span class=\"k\">except</span><span class=\"p\">:</span>\n                            <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;=&#39;</span>\n                        <span class=\"n\">subj</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">o2</span><span class=\"p\">,</span> <span class=\"p\">]</span>\n                        <span class=\"k\">while</span> <span class=\"n\">k</span><span class=\"p\">:</span>\n                            <span class=\"k\">for</span> <span class=\"n\">indx</span><span class=\"p\">,</span> <span class=\"n\">s</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">subj</span><span class=\"p\">):</span>\n                                <span class=\"k\">if</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;objects&#39;</span><span class=\"p\">:</span>\n                                    <span class=\"n\">pred</span> <span class=\"o\">=</span> <span class=\"n\">rdflib</span><span class=\"o\">.</span><span class=\"n\">term</span><span class=\"o\">.</span><span class=\"n\">URIRef</span><span class=\"p\">(</span><span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">2</span><span class=\"p\">])</span>\n                                    <span class=\"n\">res</span> <span class=\"o\">=</span> <span class=\"n\">g</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"p\">(</span><span class=\"n\">subject</span><span class=\"o\">=</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"n\">predicate</span><span class=\"o\">=</span><span class=\"n\">pred</span><span class=\"p\">)</span>\n                                    <span class=\"k\">if</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"n\">res</span><span class=\"p\">)</span> <span class=\"o\">!=</span> <span class=\"n\">types</span><span class=\"o\">.</span><span class=\"n\">GeneratorType</span><span class=\"p\">:</span>\n                                        <span class=\"k\">break</span>\n                                    <span class=\"k\">for</span> <span class=\"n\">r</span> <span class=\"ow\">in</span> <span class=\"n\">res</span><span class=\"p\">:</span>\n                                        <span class=\"k\">if</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">3</span><span class=\"p\">]:</span>\n                                            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">3</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"o\">==</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">3</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n                                                <span class=\"k\">continue</span>\n                                        <span class=\"k\">if</span> <span class=\"n\">k</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;&gt;&#39;</span><span class=\"p\">:</span>\n                                            <span class=\"n\">subj2</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n                                        <span class=\"k\">elif</span> <span class=\"n\">k</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;=&#39;</span><span class=\"p\">:</span>\n                                            <span class=\"n\">results</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">((</span><span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">],</span> <span class=\"n\">r</span><span class=\"p\">,</span> <span class=\"n\">indx</span><span class=\"p\">))</span>\n                                            <span class=\"n\">ind_type</span> <span class=\"o\">+=</span> <span class=\"p\">((</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">ind_type</span><span class=\"p\">),</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]),)</span>\n                            <span class=\"n\">cnt_2</span> <span class=\"o\">+=</span> <span class=\"mi\">2</span>\n                            <span class=\"k\">try</span><span class=\"p\">:</span>\n                                <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"n\">z</span><span class=\"p\">[</span><span class=\"n\">cnt_2</span><span class=\"p\">]</span>\n                            <span class=\"k\">except</span><span class=\"p\">:</span>\n                                <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;=&#39;</span>\n                            <span class=\"k\">if</span> <span class=\"n\">cnt</span> <span class=\"o\">+</span> <span class=\"mi\">2</span> <span class=\"o\">&gt;</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">z</span><span class=\"p\">):</span>\n                                <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n                            <span class=\"n\">cnt</span> <span class=\"o\">+=</span> <span class=\"mi\">2</span>\n                            <span class=\"n\">subj</span> <span class=\"o\">=</span> <span class=\"n\">subj2</span>\n                    <span class=\"k\">for</span> <span class=\"n\">attrb</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;matching&#39;</span><span class=\"p\">][</span><span class=\"s1\">&#39;attributes&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n                        <span class=\"n\">res_2</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;matching&#39;</span><span class=\"p\">][</span><span class=\"s1\">&#39;attributes&#39;</span><span class=\"p\">][</span><span class=\"n\">attrb</span><span class=\"p\">]:</span>\n                            <span class=\"k\">for</span> <span class=\"n\">s</span> <span class=\"ow\">in</span> <span class=\"n\">x</span><span class=\"p\">:</span>\n                                <span class=\"k\">for</span> <span class=\"n\">ind</span><span class=\"p\">,</span> <span class=\"n\">elem</span> <span class=\"ow\">in</span> <span class=\"nb\">filter</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">s</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">ind_type</span><span class=\"p\">):</span>\n                                    <span class=\"n\">elem</span> <span class=\"o\">=</span> <span class=\"n\">results</span><span class=\"p\">[</span><span class=\"n\">ind</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                                    <span class=\"n\">res_2</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">prep_string</span><span class=\"p\">((</span><span class=\"n\">elem</span><span class=\"p\">,</span> <span class=\"n\">s</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])))</span>\n                                <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n                                    <span class=\"n\">res_2</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>\n                        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">res_2</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">):</span>\n                            <span class=\"n\">res_attrb</span><span class=\"p\">[</span><span class=\"n\">attrb</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">res_2</span><span class=\"p\">)</span>\n                    <span class=\"k\">for</span> <span class=\"n\">lab</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;matching&#39;</span><span class=\"p\">][</span><span class=\"s1\">&#39;labels&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n                        <span class=\"n\">lb_type</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">LabelType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">lab</span><span class=\"p\">)</span>\n                        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;matching&#39;</span><span class=\"p\">][</span><span class=\"s1\">&#39;labels&#39;</span><span class=\"p\">][</span><span class=\"n\">lab</span><span class=\"p\">]:</span>\n                            <span class=\"k\">for</span> <span class=\"n\">ind</span><span class=\"p\">,</span> <span class=\"n\">elem</span> <span class=\"ow\">in</span> <span class=\"nb\">filter</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">a</span><span class=\"p\">:</span> <span class=\"n\">a</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">==</span><span class=\"n\">x</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">ind_type</span><span class=\"p\">):</span>\n                                <span class=\"n\">elem</span> <span class=\"o\">=</span> <span class=\"n\">results</span><span class=\"p\">[</span><span class=\"n\">ind</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                                <span class=\"n\">lb</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">prep_string</span><span class=\"p\">((</span><span class=\"n\">elem</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])),</span> <span class=\"n\">isoCode_639_3</span><span class=\"o\">=</span><span class=\"n\">elem</span><span class=\"o\">.</span><span class=\"n\">language</span><span class=\"p\">,</span> <span class=\"n\">label_type</span><span class=\"o\">=</span><span class=\"n\">lb_type</span><span class=\"p\">)</span>\n                                <span class=\"n\">labels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">lb</span><span class=\"p\">)</span>\n                    <span class=\"k\">for</span> <span class=\"n\">con</span> <span class=\"ow\">in</span> <span class=\"n\">sett_RDF_generic</span><span class=\"p\">[</span><span class=\"n\">kind</span><span class=\"p\">][</span><span class=\"s1\">&#39;matching&#39;</span><span class=\"p\">][</span><span class=\"s1\">&#39;linked objects&#39;</span><span class=\"p\">]:</span>\n                        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">]:</span>\n                            <span class=\"k\">for</span> <span class=\"n\">ind</span><span class=\"p\">,</span> <span class=\"n\">elem</span> <span class=\"ow\">in</span> <span class=\"nb\">filter</span><span class=\"p\">(</span><span class=\"k\">lambda</span> <span class=\"n\">a</span><span class=\"p\">:</span> <span class=\"n\">a</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">==</span><span class=\"n\">x</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">ind_type</span><span class=\"p\">):</span>\n                                <span class=\"n\">elem</span> <span class=\"o\">=</span> <span class=\"n\">results</span><span class=\"p\">[</span><span class=\"n\">ind</span><span class=\"p\">][</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                                <span class=\"n\">ob</span> <span class=\"o\">=</span> <span class=\"n\">GenericRDFParser</span><span class=\"p\">(</span><span class=\"n\">elem</span><span class=\"p\">,</span> <span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">])</span>\n                                <span class=\"k\">if</span> <span class=\"n\">ob</span><span class=\"o\">.</span><span class=\"n\">created</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">ob</span><span class=\"o\">.</span><span class=\"n\">saved</span><span class=\"p\">:</span>\n                                    <span class=\"n\">ob</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>   <span class=\"c1\"># TODO: We should move the save of related objects in the save routine</span>\n                                <span class=\"k\">if</span> <span class=\"n\">ob</span><span class=\"o\">.</span><span class=\"n\">settings_defined</span><span class=\"p\">:</span>\n                                    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">])</span>\n                                    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">kind</span><span class=\"p\">)</span>\n                                    <span class=\"k\">try</span><span class=\"p\">:</span>\n                                        <span class=\"n\">u</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s2\">&quot;relations&quot;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">kind</span><span class=\"o\">+</span><span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">])</span>\n                                        <span class=\"n\">u_kind</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s1\">&#39;vocabularies&#39;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">kind</span><span class=\"o\">+</span><span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"s1\">&#39;Relation&#39;</span><span class=\"p\">)</span>\n                                    <span class=\"k\">except</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">DoesNotExist</span><span class=\"p\">:</span>\n                                        <span class=\"n\">u</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s2\">&quot;relations&quot;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"n\">kind</span><span class=\"p\">)</span>\n                                        <span class=\"n\">u_kind</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s1\">&#39;vocabularies&#39;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">]</span><span class=\"o\">+</span><span class=\"n\">kind</span><span class=\"o\">+</span><span class=\"s1\">&#39;Relation&#39;</span><span class=\"p\">)</span>\n                                    <span class=\"n\">u_kind_2</span> <span class=\"o\">=</span> <span class=\"n\">u_kind</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()</span>\n                                    <span class=\"n\">u2</span> <span class=\"o\">=</span> <span class=\"n\">u</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()()</span>\n                                    <span class=\"n\">uk</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">u_kind_2</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;kind&#39;</span><span class=\"p\">])</span>\n                                    <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"n\">u2</span><span class=\"p\">,</span> <span class=\"s1\">&#39;relation_type_id&#39;</span><span class=\"p\">,</span> <span class=\"n\">uk</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n                                    <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"n\">u2</span><span class=\"p\">,</span> <span class=\"s1\">&#39;related_&#39;</span><span class=\"o\">+</span><span class=\"n\">con</span><span class=\"p\">[</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s1\">&#39;_id&#39;</span><span class=\"p\">,</span> <span class=\"n\">ob</span><span class=\"o\">.</span><span class=\"n\">objct</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n                                    <span class=\"n\">related_objcts</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">u2</span><span class=\"p\">)</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">res_attrb</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">objct</span> <span class=\"o\">=</span> <span class=\"n\">objct</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">res_attrb</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"n\">labels</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">related_objcts</span> <span class=\"o\">=</span> <span class=\"n\">related_objcts</span></div>\n</pre></div>", "parents": [{"title": "Module code", "link": "../../"}], "sidebars": null, "alabaster_version": "0.7.10", "customsidebar": null}