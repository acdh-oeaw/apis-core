{"title": "entities.views", "current_page_name": "_modules/entities/views", "body": "<h1>Source code for entities.views</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"c1\"># -*- coding: utf-8 -*-</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.shortcuts</span> <span class=\"k\">import</span> <span class=\"n\">render</span><span class=\"p\">,</span> <span class=\"n\">redirect</span><span class=\"p\">,</span> <span class=\"n\">get_object_or_404</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.urlresolvers</span> <span class=\"k\">import</span> <span class=\"n\">reverse_lazy</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.decorators</span> <span class=\"k\">import</span> <span class=\"n\">login_required</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.decorators</span> <span class=\"k\">import</span> <span class=\"n\">method_decorator</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.urlresolvers</span> <span class=\"k\">import</span> <span class=\"n\">reverse</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views.generic.edit</span> <span class=\"k\">import</span> <span class=\"n\">DeleteView</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views</span> <span class=\"k\">import</span> <span class=\"n\">generic</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.contenttypes.models</span> <span class=\"k\">import</span> <span class=\"n\">ContentType</span>\n<span class=\"c1\">#from reversion import revisions as reversion</span>\n<span class=\"kn\">from</span> <span class=\"nn\">reversion.models</span> <span class=\"k\">import</span> <span class=\"n\">Version</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.http</span> <span class=\"k\">import</span> <span class=\"n\">HttpResponse</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.http</span> <span class=\"k\">import</span> <span class=\"n\">HttpResponseRedirect</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models</span> <span class=\"k\">import</span> <span class=\"n\">Q</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django_tables2</span> <span class=\"k\">import</span> <span class=\"n\">SingleTableView</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django_tables2</span> <span class=\"k\">import</span> <span class=\"n\">RequestConfig</span>\n<span class=\"kn\">from</span> <span class=\"nn\">reversion_compare.views</span> <span class=\"k\">import</span> <span class=\"n\">HistoryCompareDetailView</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">.models</span> <span class=\"k\">import</span> <span class=\"n\">Person</span><span class=\"p\">,</span> <span class=\"n\">Place</span><span class=\"p\">,</span> <span class=\"n\">Institution</span><span class=\"p\">,</span> <span class=\"n\">Event</span><span class=\"p\">,</span> <span class=\"n\">Work</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.forms</span> <span class=\"k\">import</span> <span class=\"p\">(</span><span class=\"n\">PersonForm</span><span class=\"p\">,</span> <span class=\"n\">PlaceForm</span><span class=\"p\">,</span> <span class=\"n\">InstitutionForm</span><span class=\"p\">,</span> <span class=\"n\">EventForm</span><span class=\"p\">,</span> <span class=\"n\">FullTextForm</span><span class=\"p\">,</span> <span class=\"n\">SearchForm</span><span class=\"p\">,</span>\n                    <span class=\"n\">WorkForm</span><span class=\"p\">,</span> <span class=\"n\">GenericFilterFormHelper</span><span class=\"p\">,</span> <span class=\"n\">NetworkVizFilterForm</span><span class=\"p\">,</span> <span class=\"n\">PersonResolveUriForm</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">relations.models</span> <span class=\"k\">import</span> <span class=\"p\">(</span><span class=\"n\">PersonPerson</span><span class=\"p\">,</span> <span class=\"n\">PersonInstitution</span><span class=\"p\">,</span> <span class=\"n\">PersonEvent</span><span class=\"p\">,</span> \n                              <span class=\"n\">PersonPlace</span><span class=\"p\">,</span> <span class=\"n\">InstitutionEvent</span><span class=\"p\">,</span> <span class=\"n\">InstitutionPlace</span><span class=\"p\">,</span> <span class=\"n\">InstitutionInstitution</span><span class=\"p\">,</span> <span class=\"n\">PlacePlace</span><span class=\"p\">,</span>\n                              <span class=\"n\">PlaceEvent</span><span class=\"p\">,</span> <span class=\"n\">PersonWork</span><span class=\"p\">,</span> <span class=\"n\">InstitutionWork</span><span class=\"p\">,</span> <span class=\"n\">PlaceWork</span><span class=\"p\">,</span> <span class=\"n\">EventWork</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">vocabularies.models</span> <span class=\"k\">import</span> <span class=\"n\">LabelType</span>\n<span class=\"kn\">from</span> <span class=\"nn\">relations.tables</span> <span class=\"k\">import</span> <span class=\"p\">(</span><span class=\"n\">PersonInstitutionTable</span><span class=\"p\">,</span> <span class=\"n\">PersonPersonTable</span><span class=\"p\">,</span> <span class=\"n\">PersonPlaceTable</span><span class=\"p\">,</span>\n                              <span class=\"n\">EntityLabelTable</span><span class=\"p\">,</span> <span class=\"n\">InstitutionPlaceTable</span><span class=\"p\">,</span> <span class=\"n\">InstitutionInstitutionTable</span><span class=\"p\">,</span>\n                              <span class=\"n\">PlacePlaceTable</span><span class=\"p\">,</span> <span class=\"n\">PersonEventTable</span><span class=\"p\">,</span> <span class=\"n\">PlaceEventTable</span><span class=\"p\">,</span> <span class=\"n\">InstitutionEventTable</span><span class=\"p\">,</span>\n                              <span class=\"n\">PersonWorkTable</span><span class=\"p\">,</span> <span class=\"n\">InstitutionWorkTable</span><span class=\"p\">,</span> <span class=\"n\">PlaceWorkTable</span><span class=\"p\">,</span> <span class=\"n\">EventWorkTable</span><span class=\"p\">,</span> <span class=\"n\">EntityUriTable</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">metainfo.models</span> <span class=\"k\">import</span> <span class=\"n\">Uri</span><span class=\"p\">,</span> <span class=\"n\">UriCandidate</span><span class=\"p\">,</span> <span class=\"n\">TempEntityClass</span><span class=\"p\">,</span> <span class=\"n\">Text</span>\n<span class=\"kn\">from</span> <span class=\"nn\">apis.settings.base</span> <span class=\"k\">import</span> <span class=\"n\">BASE_DIR</span>\n<span class=\"kn\">from</span> <span class=\"nn\">helper_functions.stanbolQueries</span> <span class=\"k\">import</span> <span class=\"n\">retrieve_obj</span>\n<span class=\"kn\">from</span> <span class=\"nn\">helper_functions.parseSearch</span> <span class=\"k\">import</span> <span class=\"n\">generic_search</span>\n<span class=\"kn\">from</span> <span class=\"nn\">helper_functions.highlighter</span> <span class=\"k\">import</span> <span class=\"n\">highlight_text</span>\n<span class=\"kn\">from</span> <span class=\"nn\">helper_functions.RDFparsers</span> <span class=\"k\">import</span> <span class=\"n\">geonamesPlaceCL</span>\n<span class=\"kn\">from</span> <span class=\"nn\">labels.models</span> <span class=\"k\">import</span> <span class=\"n\">Label</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.tables</span> <span class=\"k\">import</span> <span class=\"n\">PersonTable</span><span class=\"p\">,</span> <span class=\"n\">PlaceTable</span><span class=\"p\">,</span> <span class=\"n\">InstitutionTable</span><span class=\"p\">,</span> <span class=\"n\">EventTable</span><span class=\"p\">,</span> <span class=\"n\">WorkTable</span>\n<span class=\"kn\">from</span> <span class=\"nn\">.filters</span> <span class=\"k\">import</span> <span class=\"n\">PersonListFilter</span><span class=\"p\">,</span> <span class=\"n\">PlaceListFilter</span><span class=\"p\">,</span> <span class=\"n\">InstitutionListFilter</span><span class=\"p\">,</span> <span class=\"n\">EventListFilter</span><span class=\"p\">,</span> <span class=\"n\">WorkListFilter</span>\n<span class=\"kn\">from</span> <span class=\"nn\">highlighter.forms</span> <span class=\"k\">import</span> <span class=\"n\">SelectAnnotationProject</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">json</span>\n\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   Helper Functions</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">set_session_variables</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"n\">ann_proj_pk</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;project&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">types</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">getlist</span><span class=\"p\">(</span><span class=\"s1\">&#39;types&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">users_show</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">getlist</span><span class=\"p\">(</span><span class=\"s1\">&#39;users_show&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">users_show</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">types</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">session</span><span class=\"p\">[</span><span class=\"s1\">&#39;entity_types_highlighter&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">types</span>\n    <span class=\"k\">if</span> <span class=\"n\">users_show</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">session</span><span class=\"p\">[</span><span class=\"s1\">&#39;users_show_highlighter&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">users_show</span>\n    <span class=\"k\">if</span> <span class=\"n\">ann_proj_pk</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">session</span><span class=\"p\">[</span><span class=\"s1\">&#39;annotation_project&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">ann_proj_pk</span>\n    <span class=\"k\">return</span> <span class=\"n\">request</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">get_highlighted_texts</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">):</span>\n    <span class=\"n\">set_ann_proj</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">session</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;annotation_project&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"n\">entity_types_highlighter</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">session</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;entity_types_highlighter&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">users_show</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">session</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;users_show_highlighter&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n    <span class=\"n\">object_texts</span> <span class=\"o\">=</span> <span class=\"p\">[{</span><span class=\"s1\">&#39;text&#39;</span><span class=\"p\">:</span> <span class=\"n\">highlight_text</span><span class=\"p\">(</span>\n        <span class=\"n\">x</span><span class=\"p\">,</span>\n        <span class=\"n\">set_ann_proj</span><span class=\"o\">=</span><span class=\"n\">set_ann_proj</span><span class=\"p\">,</span>\n        <span class=\"n\">types</span><span class=\"o\">=</span><span class=\"n\">entity_types_highlighter</span><span class=\"p\">,</span>\n        <span class=\"n\">users_show</span><span class=\"o\">=</span><span class=\"n\">users_show</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">strip</span><span class=\"p\">(),</span>\n                     <span class=\"s1\">&#39;id&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n                     <span class=\"s1\">&#39;kind&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">kind</span><span class=\"p\">}</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">Text</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">tempentityclass</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)]</span>\n    <span class=\"n\">ann_proj_form</span> <span class=\"o\">=</span> <span class=\"n\">SelectAnnotationProject</span><span class=\"p\">(</span>\n        <span class=\"n\">set_ann_proj</span><span class=\"o\">=</span><span class=\"n\">set_ann_proj</span><span class=\"p\">,</span>\n        <span class=\"n\">entity_types_highlighter</span><span class=\"o\">=</span><span class=\"n\">entity_types_highlighter</span><span class=\"p\">,</span>\n        <span class=\"n\">users_show_highlighter</span><span class=\"o\">=</span><span class=\"n\">users_show</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">object_texts</span><span class=\"p\">,</span> <span class=\"n\">ann_proj_form</span>\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   GenericViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">GenericListView</span><span class=\"p\">(</span><span class=\"n\">SingleTableView</span><span class=\"p\">):</span>\n    <span class=\"n\">filter_class</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">formhelper_class</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">context_filter_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;filter&#39;</span>\n    <span class=\"n\">paginate_by</span> <span class=\"o\">=</span> <span class=\"mi\">25</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"n\">qs</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter_class</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"o\">=</span><span class=\"n\">qs</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">helper</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formhelper_class</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"o\">.</span><span class=\"n\">qs</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_table</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"n\">table</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">get_table</span><span class=\"p\">()</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span>\n            <span class=\"s1\">&#39;page&#39;</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s1\">&#39;per_page&#39;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">paginate_by</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">table</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">table</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_context_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">get_context_data</span><span class=\"p\">()</span>\n        <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">context_filter_name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter</span>\n        <span class=\"k\">return</span> <span class=\"n\">context</span>\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   PersonViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">PersonListViewOld</span><span class=\"p\">(</span><span class=\"n\">generic</span><span class=\"o\">.</span><span class=\"n\">ListView</span><span class=\"p\">):</span>  <span class=\"c1\"># deprecated</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Person</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/person_list.html&#39;</span>\n    <span class=\"n\">context_object_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;object_list&#39;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">Person</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">PersonListView</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Person</span>\n    <span class=\"n\">table_class</span> <span class=\"o\">=</span> <span class=\"n\">PersonTable</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/person_list_generic.html&#39;</span>\n    <span class=\"n\">filter_class</span> <span class=\"o\">=</span> <span class=\"n\">PersonListFilter</span>\n    <span class=\"n\">formhelper_class</span> <span class=\"o\">=</span> <span class=\"n\">GenericFilterFormHelper</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">person_create</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PersonForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:person_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/person_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                    <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                    <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PersonForm</span><span class=\"p\">()</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/person_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">person_edit</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"p\">):</span>\n    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">get_object_or_404</span><span class=\"p\">(</span><span class=\"n\">Person</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"o\">=</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PersonForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:person_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/person_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                    <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                    <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n                    <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"n\">set_session_variables</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">object_person_pre</span> <span class=\"o\">=</span> <span class=\"n\">PersonPerson</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span>\n            <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_personA</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"o\">|</span> <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_personB</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">))</span>\n        <span class=\"n\">object_person</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">object_person_pre</span><span class=\"p\">:</span>\n            <span class=\"n\">object_person</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">get_table_dict</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">))</span>\n        <span class=\"n\">tb_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonPersonTable</span><span class=\"p\">(</span><span class=\"n\">object_person</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s2\">&quot;PP-&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PP-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_person</span><span class=\"p\">)</span>\n        <span class=\"n\">object_institution</span> <span class=\"o\">=</span> <span class=\"n\">PersonInstitution</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution</span> <span class=\"o\">=</span> <span class=\"n\">PersonInstitutionTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_institution</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PI-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PI-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_institution</span><span class=\"p\">)</span>\n        <span class=\"n\">object_event</span> <span class=\"o\">=</span> <span class=\"n\">PersonEvent</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event</span> <span class=\"o\">=</span> <span class=\"n\">PersonEventTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_event</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PE-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PE-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_event</span><span class=\"p\">)</span>\n        <span class=\"n\">object_place</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlace</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlaceTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_place</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PPL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PPL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_place</span><span class=\"p\">)</span>\n        <span class=\"n\">object_work</span> <span class=\"o\">=</span> <span class=\"n\">PersonWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_person</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work</span> <span class=\"o\">=</span> <span class=\"n\">PersonWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_work</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PWRK-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_work</span><span class=\"p\">)</span>\n        <span class=\"n\">object_uri</span> <span class=\"o\">=</span> <span class=\"n\">Uri</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_uri</span> <span class=\"o\">=</span> <span class=\"n\">EntityUriTable</span><span class=\"p\">(</span><span class=\"n\">object_uri</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PURI-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_uri_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PURI-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_uri</span><span class=\"p\">)</span>\n        <span class=\"n\">object_revisions</span> <span class=\"o\">=</span> <span class=\"n\">Version</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_for_object</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_lod</span> <span class=\"o\">=</span> <span class=\"n\">Uri</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_texts</span><span class=\"p\">,</span> <span class=\"n\">ann_proj_form</span> <span class=\"o\">=</span> <span class=\"n\">get_highlighted_texts</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_labels</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label</span> <span class=\"o\">=</span> <span class=\"n\">EntityLabelTable</span><span class=\"p\">(</span><span class=\"n\">object_labels</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_label</span><span class=\"p\">)</span>\n        <span class=\"n\">right_panel</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Uri&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_uri</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonResolveUri&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_uri_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonPerson&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonInstitution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonPlace&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonEvent&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Label&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonLabel&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label_open</span><span class=\"p\">)]</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PersonForm</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/person_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n            <span class=\"s1\">&#39;entity_type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;right_panel&#39;</span><span class=\"p\">:</span> <span class=\"n\">right_panel</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_revisions&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_revisions</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_texts&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_texts</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_lod&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_lod</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;ann_proj_form&#39;</span><span class=\"p\">:</span> <span class=\"n\">ann_proj_form</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">PersonDelete</span><span class=\"p\">(</span><span class=\"n\">DeleteView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Person</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;webpage/confirm_delete.html&#39;</span>\n    <span class=\"n\">success_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:person_list&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   InstitutionViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">InstitutionListViewOld</span><span class=\"p\">(</span><span class=\"n\">generic</span><span class=\"o\">.</span><span class=\"n\">ListView</span><span class=\"p\">):</span>     <span class=\"c1\">#deprecated</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/institution_list.html&#39;</span>\n    <span class=\"n\">context_object_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;object_list&#39;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">InstitutionListView</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span>\n    <span class=\"n\">table_class</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionTable</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/institution_list_generic.html&#39;</span>\n    <span class=\"n\">filter_class</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionListFilter</span>\n    <span class=\"n\">formhelper_class</span> <span class=\"o\">=</span> <span class=\"n\">GenericFilterFormHelper</span>\n\n<span class=\"c1\"># class InstitutionListViewCustom(generic.ListView):</span>\n<span class=\"c1\">#   model = Institution</span>\n<span class=\"c1\">#   template_name = &#39;entities/institution_list.html&#39;</span>\n<span class=\"c1\">#   context_object_name = &#39;object_list&#39;</span>\n\n<span class=\"c1\">#   def get_queryset(self, collection_id):</span>\n<span class=\"c1\">#       return Institution.objects.filter(collection__id=collection_id).order_by(&#39;name&#39;)</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">institution_custom_list</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">collection_id</span><span class=\"p\">):</span>\n    <span class=\"n\">collection_id</span> <span class=\"o\">=</span> <span class=\"n\">collection_id</span>\n    <span class=\"n\">institutions</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">collection__id</span><span class=\"o\">=</span><span class=\"n\">collection_id</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;object_list&#39;</span><span class=\"p\">:</span> <span class=\"n\">institutions</span><span class=\"p\">}</span>\n    <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s2\">&quot;number_of_objects&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">institutions</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/institution_list.html&#39;</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">institution_create</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:institution_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/institution_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionForm</span><span class=\"p\">()</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/institution_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">institution_edit</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"p\">):</span>\n    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">get_object_or_404</span><span class=\"p\">(</span><span class=\"n\">Institution</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"o\">=</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:institution_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/institution_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"n\">set_session_variables</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">object_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitution</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span>\n            <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_institutionA</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"o\">|</span> <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_institutionB</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">))</span>\n        <span class=\"n\">tb_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionInstitutionTable</span><span class=\"p\">([</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">get_table_dict</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">object_institution</span><span class=\"p\">],</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s2\">&quot;II-&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;II-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_institution</span><span class=\"p\">)</span>\n        <span class=\"n\">object_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonInstitution</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_institution</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonInstitutionTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_person</span><span class=\"p\">),</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PI-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PI-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_person</span><span class=\"p\">)</span>\n        <span class=\"n\">object_event</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionEvent</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_institution</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionEventTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_event</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;IEV-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;IEV-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_event</span><span class=\"p\">)</span>\n        <span class=\"n\">object_place</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionPlace</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_institution</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionPlaceTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_place</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;IPL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;IPL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_place</span><span class=\"p\">)</span>\n        <span class=\"n\">object_work</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_institution</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_work</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;IWRK-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;IWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_work</span><span class=\"p\">)</span>\n        <span class=\"n\">object_revisions</span> <span class=\"o\">=</span> <span class=\"n\">Version</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_for_object</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_labels</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label</span> <span class=\"o\">=</span> <span class=\"n\">EntityLabelTable</span><span class=\"p\">(</span><span class=\"n\">object_labels</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;IL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;IL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_label</span><span class=\"p\">)</span>\n        <span class=\"n\">object_texts</span><span class=\"p\">,</span> <span class=\"n\">ann_proj_form</span> <span class=\"o\">=</span> <span class=\"n\">get_highlighted_texts</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">right_panel</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution</span><span class=\"p\">,</span> <span class=\"s1\">&#39;InstitutionInstitution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonInstitution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place</span><span class=\"p\">,</span> <span class=\"s1\">&#39;InstitutionPlace&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event</span><span class=\"p\">,</span> <span class=\"s1\">&#39;InstitutionEvent&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work</span><span class=\"p\">,</span> <span class=\"s1\">&#39;InstitutionWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Label&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonLabel&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label_open</span><span class=\"p\">)]</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionForm</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/institution_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n            <span class=\"s1\">&#39;entity_type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;right_panel&#39;</span><span class=\"p\">:</span> <span class=\"n\">right_panel</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_texts&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_texts</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;ann_proj_form&#39;</span><span class=\"p\">:</span> <span class=\"n\">ann_proj_form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_revisions&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_revisions</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">InstitutionDelete</span><span class=\"p\">(</span><span class=\"n\">DeleteView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Institution</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;webpage/confirm_delete.html&#39;</span>\n    <span class=\"n\">success_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:institution_list&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   PlaceViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">PlaceListViewOld</span><span class=\"p\">(</span><span class=\"n\">generic</span><span class=\"o\">.</span><span class=\"n\">ListView</span><span class=\"p\">):</span>  <span class=\"c1\">#deprecated </span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Place</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/place_list.html&#39;</span>\n    <span class=\"n\">context_object_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;object_list&#39;</span>\n    <span class=\"n\">paginate_by</span> <span class=\"o\">=</span> <span class=\"mi\">25</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_context_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">PlaceListView</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">get_context_data</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n        <span class=\"n\">q</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;search&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s1\">&#39;search&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">q</span>\n        <span class=\"k\">if</span> <span class=\"n\">q</span><span class=\"p\">:</span>\n            <span class=\"n\">sf</span> <span class=\"o\">=</span> <span class=\"n\">SearchForm</span><span class=\"p\">(</span><span class=\"n\">initial</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;search&#39;</span><span class=\"p\">:</span> <span class=\"n\">q</span><span class=\"p\">})</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">sf</span> <span class=\"o\">=</span> <span class=\"n\">SearchForm</span><span class=\"p\">()</span>\n        <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s1\">&#39;SearchForm&#39;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">sf</span>\n        <span class=\"k\">return</span> <span class=\"n\">context</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;search&quot;</span><span class=\"p\">):</span>\n            <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"n\">generic_search</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">Place</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;status&#39;</span><span class=\"p\">],</span> <span class=\"n\">query_param</span><span class=\"o\">=</span><span class=\"s1\">&#39;search&#39;</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">queryset</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">PlaceListView</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Place</span>\n    <span class=\"n\">table_class</span> <span class=\"o\">=</span> <span class=\"n\">PlaceTable</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/place_list_generic.html&#39;</span>\n    <span class=\"n\">filter_class</span> <span class=\"o\">=</span> <span class=\"n\">PlaceListFilter</span>\n    <span class=\"n\">formhelper_class</span> <span class=\"o\">=</span> <span class=\"n\">GenericFilterFormHelper</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">place_create</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PlaceForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:place_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities:place_create_generic&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                        <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                        <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PlaceForm</span><span class=\"p\">()</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/place_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                        <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                        <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">place_edit</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"p\">):</span>\n    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">get_object_or_404</span><span class=\"p\">(</span><span class=\"n\">Place</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"o\">=</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PlaceForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:place_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/place_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                <span class=\"s1\">&#39;entity_type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"n\">set_session_variables</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">object_place</span> <span class=\"o\">=</span> <span class=\"n\">PlacePlace</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span>\n            <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_placeA</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"o\">|</span> <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">related_placeB</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">))</span>\n        <span class=\"n\">tb_place</span> <span class=\"o\">=</span> <span class=\"n\">PlacePlaceTable</span><span class=\"p\">([</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">get_table_dict</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">object_place</span><span class=\"p\">],</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s2\">&quot;PP-&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PP-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_place</span><span class=\"p\">)</span>\n        <span class=\"n\">object_event</span> <span class=\"o\">=</span> <span class=\"n\">PlaceEvent</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event</span> <span class=\"o\">=</span> <span class=\"n\">PlaceEventTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_event</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PLEV-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PLEV-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_event</span><span class=\"p\">)</span>\n        <span class=\"n\">object_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionPlace</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionPlaceTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_institution</span><span class=\"p\">),</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;IPL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;IPL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_institution</span><span class=\"p\">)</span>\n        <span class=\"n\">object_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlace</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonPlaceTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_person</span><span class=\"p\">),</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PPL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PPL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_person</span><span class=\"p\">)</span>\n        <span class=\"n\">object_work</span> <span class=\"o\">=</span> <span class=\"n\">PlaceWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_place</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work</span> <span class=\"o\">=</span> <span class=\"n\">PlaceWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_work</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PLWRK-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PLWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_work</span><span class=\"p\">)</span>\n        <span class=\"n\">object_revisions</span> <span class=\"o\">=</span> <span class=\"n\">Version</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_for_object</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_lod</span> <span class=\"o\">=</span> <span class=\"n\">Uri</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_labels</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label</span> <span class=\"o\">=</span> <span class=\"n\">EntityLabelTable</span><span class=\"p\">(</span><span class=\"n\">object_labels</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PLL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PLL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_label</span><span class=\"p\">)</span>\n        <span class=\"n\">object_texts</span><span class=\"p\">,</span> <span class=\"n\">ann_proj_form</span> <span class=\"o\">=</span> <span class=\"n\">get_highlighted_texts</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">right_panel</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PlacePlace&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonPlace&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution</span><span class=\"p\">,</span> <span class=\"s1\">&#39;InstitutionPlace&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PlaceEvent&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PlaceWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Label&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonLabel&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label_open</span><span class=\"p\">)]</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PlaceForm</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/place_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n            <span class=\"s1\">&#39;entity_type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;right_panel&#39;</span><span class=\"p\">:</span> <span class=\"n\">right_panel</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_revisions&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_revisions</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_texts&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_texts</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;ann_proj_form&#39;</span><span class=\"p\">:</span> <span class=\"n\">ann_proj_form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_lod&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_lod</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">PlaceDelete</span><span class=\"p\">(</span><span class=\"n\">DeleteView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Place</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;webpage/confirm_delete.html&#39;</span>\n    <span class=\"n\">success_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:place_list&#39;</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">dispatch</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">PlaceDelete</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">dispatch</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   EventViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">EventListView</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Event</span>\n    <span class=\"n\">table_class</span> <span class=\"o\">=</span> <span class=\"n\">EventTable</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/event_list_generic.html&#39;</span>\n    <span class=\"n\">filter_class</span> <span class=\"o\">=</span> <span class=\"n\">EventListFilter</span>\n    <span class=\"n\">formhelper_class</span> <span class=\"o\">=</span> <span class=\"n\">GenericFilterFormHelper</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">event_create</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">EventForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:event_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/event_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                    <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                    <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">EventForm</span><span class=\"p\">()</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/event_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">event_edit</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"p\">):</span>\n    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">get_object_or_404</span><span class=\"p\">(</span><span class=\"n\">Event</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"o\">=</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">EventForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:event_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/event_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"n\">set_session_variables</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">object_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonEvent</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_event</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonEventTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_person</span><span class=\"p\">),</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PE-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PE-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_person</span><span class=\"p\">)</span>\n        <span class=\"n\">object_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionEvent</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_event</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionEventTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_institution</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;IEV-&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;IEV-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_institution</span><span class=\"p\">)</span>\n        <span class=\"n\">object_place</span> <span class=\"o\">=</span> <span class=\"n\">PlaceEvent</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_event</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place</span> <span class=\"o\">=</span> <span class=\"n\">PlaceEventTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_place</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PLEV-&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PLEV-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_place</span><span class=\"p\">)</span>\n        <span class=\"n\">object_work</span> <span class=\"o\">=</span> <span class=\"n\">EventWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_event</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work</span> <span class=\"o\">=</span> <span class=\"n\">EventWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_work</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;EWRK-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_work_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;EWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_work</span><span class=\"p\">)</span>\n        <span class=\"n\">object_revisions</span> <span class=\"o\">=</span> <span class=\"n\">Version</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_for_object</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_labels</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label</span> <span class=\"o\">=</span> <span class=\"n\">EntityLabelTable</span><span class=\"p\">(</span><span class=\"n\">object_labels</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;EL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;EL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_label</span><span class=\"p\">)</span>\n        <span class=\"n\">object_texts</span><span class=\"p\">,</span> <span class=\"n\">ann_proj_form</span> <span class=\"o\">=</span> <span class=\"n\">get_highlighted_texts</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">right_panel</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution</span><span class=\"p\">,</span> <span class=\"s1\">&#39;InstitutionEvent&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonEvent&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PlaceEvent&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work</span><span class=\"p\">,</span> <span class=\"s1\">&#39;EventWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_work_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Label&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonLabel&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label_open</span><span class=\"p\">)]</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">EventForm</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/event_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n            <span class=\"s1\">&#39;entity_type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;right_panel&#39;</span><span class=\"p\">:</span> <span class=\"n\">right_panel</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_texts&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_texts</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;ann_proj_form&#39;</span><span class=\"p\">:</span> <span class=\"n\">ann_proj_form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_revisions&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_revisions</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">EventDelete</span><span class=\"p\">(</span><span class=\"n\">DeleteView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Event</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;webpage/confirm_delete.html&#39;</span>\n    <span class=\"n\">success_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:event_list&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   WorkViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">WorkListView</span><span class=\"p\">(</span><span class=\"n\">GenericListView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Work</span>\n    <span class=\"n\">table_class</span> <span class=\"o\">=</span> <span class=\"n\">WorkTable</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/work_list_generic.html&#39;</span>\n    <span class=\"n\">filter_class</span> <span class=\"o\">=</span> <span class=\"n\">WorkListFilter</span>\n    <span class=\"n\">formhelper_class</span> <span class=\"o\">=</span> <span class=\"n\">GenericFilterFormHelper</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">work_create</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">WorkForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:work_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/work_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                    <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                    <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">WorkForm</span><span class=\"p\">()</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/work_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">work_edit</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"p\">):</span>\n    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">get_object_or_404</span><span class=\"p\">(</span><span class=\"n\">Work</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"o\">=</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">WorkForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span> <span class=\"ow\">and</span> <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n            <span class=\"n\">form_text</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:work_list&#39;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/work_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n                <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n                <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">})</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"n\">set_session_variables</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">object_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_work</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person</span> <span class=\"o\">=</span> <span class=\"n\">PersonWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_person</span><span class=\"p\">),</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PWRK-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_person_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_person</span><span class=\"p\">)</span>\n        <span class=\"n\">object_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_work</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution</span> <span class=\"o\">=</span> <span class=\"n\">InstitutionWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_institution</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;IWRK-&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_institution_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;IWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_institution</span><span class=\"p\">)</span>\n        <span class=\"n\">object_place</span> <span class=\"o\">=</span> <span class=\"n\">PlaceWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_work</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place</span> <span class=\"o\">=</span> <span class=\"n\">PlaceWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_place</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;PLWRK-&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_place_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;PLWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">object_event</span> <span class=\"o\">=</span> <span class=\"n\">EventWork</span><span class=\"o\">.</span><span class=\"n\">annotation_links</span><span class=\"o\">.</span><span class=\"n\">filter_ann_proj</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">related_work</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event</span> <span class=\"o\">=</span> <span class=\"n\">EventWorkTable</span><span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">object_event</span><span class=\"p\">),</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;EWRK-&#39;</span><span class=\"p\">,</span> <span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_event_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;EWRK-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_place</span><span class=\"p\">)</span>\n        <span class=\"n\">object_revisions</span> <span class=\"o\">=</span> <span class=\"n\">Version</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_for_object</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">object_labels</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label</span> <span class=\"o\">=</span> <span class=\"n\">EntityLabelTable</span><span class=\"p\">(</span><span class=\"n\">object_labels</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;WRKL-&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">tb_label_open</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s1\">&#39;WRKL-page&#39;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">RequestConfig</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">paginate</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;per_page&quot;</span><span class=\"p\">:</span> <span class=\"mi\">10</span><span class=\"p\">})</span><span class=\"o\">.</span><span class=\"n\">configure</span><span class=\"p\">(</span><span class=\"n\">tb_label</span><span class=\"p\">)</span>\n        <span class=\"n\">object_texts</span><span class=\"p\">,</span> <span class=\"n\">ann_proj_form</span> <span class=\"o\">=</span> <span class=\"n\">get_highlighted_texts</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">right_panel</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution</span><span class=\"p\">,</span> <span class=\"s1\">&#39;InstitutionWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_institution_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Person&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_person_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Place&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PlaceWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_place_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Event&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event</span><span class=\"p\">,</span> <span class=\"s1\">&#39;EventWork&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_event_open</span><span class=\"p\">),</span>\n            <span class=\"p\">(</span><span class=\"s1\">&#39;Label&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label</span><span class=\"p\">,</span> <span class=\"s1\">&#39;PersonLabel&#39;</span><span class=\"p\">,</span> <span class=\"n\">tb_label_open</span><span class=\"p\">)]</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">WorkForm</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"n\">form_text</span> <span class=\"o\">=</span> <span class=\"n\">FullTextForm</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/work_create_generic.html&#39;</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n            <span class=\"s1\">&#39;entity_type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;Work&#39;</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;form_text&#39;</span><span class=\"p\">:</span> <span class=\"n\">form_text</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;instance&#39;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;right_panel&#39;</span><span class=\"p\">:</span> <span class=\"n\">right_panel</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_texts&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_texts</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;ann_proj_form&#39;</span><span class=\"p\">:</span> <span class=\"n\">ann_proj_form</span><span class=\"p\">,</span>\n            <span class=\"s1\">&#39;object_revisions&#39;</span><span class=\"p\">:</span> <span class=\"n\">object_revisions</span><span class=\"p\">})</span>\n\n\n<span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">login_required</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;dispatch&#39;</span><span class=\"p\">)</span>\n<span class=\"k\">class</span> <span class=\"nc\">WorkDelete</span><span class=\"p\">(</span><span class=\"n\">DeleteView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Work</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;webpage/confirm_delete.html&#39;</span>\n    <span class=\"n\">success_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:work_list&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   OtherViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n<span class=\"nd\">@login_required</span>\n<div class=\"viewcode-block\" id=\"getGeoJson\"><a class=\"viewcode-back\" href=\"../../../modules/entities/#entities.views.getGeoJson\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">getGeoJson</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Used to retrieve GeoJsons for single objects&#39;&#39;&#39;</span>\n    <span class=\"c1\">#if request.is_ajax():</span>\n    <span class=\"n\">pk_obj</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;object_id&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">instance</span> <span class=\"o\">=</span> <span class=\"n\">get_object_or_404</span><span class=\"p\">(</span><span class=\"n\">Place</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"o\">=</span><span class=\"n\">pk_obj</span><span class=\"p\">)</span>\n    <span class=\"n\">uria</span> <span class=\"o\">=</span> <span class=\"n\">Uri</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n    <span class=\"n\">urib</span> <span class=\"o\">=</span> <span class=\"n\">UriCandidate</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">instance</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">urib</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"n\">uric</span> <span class=\"o\">=</span> <span class=\"n\">urib</span>\n        <span class=\"n\">select_text</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"k\">elif</span> <span class=\"n\">uria</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n        <span class=\"n\">uric</span> <span class=\"o\">=</span> <span class=\"n\">uria</span>\n        <span class=\"n\">select_text</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&lt;a href=&#39;http://</span><span class=\"si\">{}</span><span class=\"s2\">&#39;&gt;URI&lt;/a&gt;&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">uria</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n    <span class=\"n\">lst_json</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"k\">if</span> <span class=\"n\">uric</span><span class=\"o\">.</span><span class=\"n\">count</span><span class=\"p\">()</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"ow\">and</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">status</span> <span class=\"o\">!=</span> <span class=\"s1\">&#39;distinct&#39;</span><span class=\"p\">:</span>\n        <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">uric</span><span class=\"p\">:</span>\n            <span class=\"n\">o</span> <span class=\"o\">=</span> <span class=\"n\">retrieve_obj</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">o</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">select_text</span><span class=\"p\">:</span>\n                    <span class=\"n\">url_r</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:resolve_ambigue_place&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">),</span> <span class=\"s1\">&#39;uri&#39;</span><span class=\"p\">:</span> <span class=\"n\">o</span><span class=\"p\">[</span><span class=\"s1\">&#39;representation&#39;</span><span class=\"p\">][</span><span class=\"s1\">&#39;id&#39;</span><span class=\"p\">][</span><span class=\"mi\">7</span><span class=\"p\">:]})</span>\n                    <span class=\"n\">select_text</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&lt;a href=&#39;</span><span class=\"si\">{}</span><span class=\"s2\">&#39;&gt;Select this URI&lt;/a&gt;&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">url_r</span><span class=\"p\">)</span>\n                <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;geometry&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Point&quot;</span><span class=\"p\">,</span>\n                        <span class=\"s2\">&quot;coordinates&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                            <span class=\"nb\">float</span><span class=\"p\">(</span>\n                                <span class=\"n\">o</span><span class=\"p\">[</span><span class=\"s1\">&#39;representation&#39;</span><span class=\"p\">]</span>\n                                <span class=\"p\">[</span><span class=\"s1\">&#39;http://www.w3.org/2003/01/geo/wgs84_pos#long&#39;</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">]),</span>\n                            <span class=\"nb\">float</span><span class=\"p\">(</span>\n                                <span class=\"n\">o</span><span class=\"p\">[</span><span class=\"s1\">&#39;representation&#39;</span><span class=\"p\">]</span>\n                                <span class=\"p\">[</span><span class=\"s1\">&#39;http://www.w3.org/2003/01/geo/wgs84_pos#lat&#39;</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n                        <span class=\"p\">]</span>\n                        <span class=\"p\">},</span>\n                    <span class=\"s2\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Feature&quot;</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;properties&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;popupContent&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;&lt;b&gt;\u00d6BL name:&lt;/b&gt; </span><span class=\"si\">%s</span><span class=\"s2\">&lt;br/&gt;&lt;b&gt;Geonames:&lt;/b&gt; </span><span class=\"si\">%s</span><span class=\"s2\">&lt;br/&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">o</span><span class=\"p\">[</span><span class=\"s1\">&#39;representation&#39;</span><span class=\"p\">][</span><span class=\"s1\">&#39;http://www.geonames.org/ontology#name&#39;</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"s1\">&#39;value&#39;</span><span class=\"p\">],</span> <span class=\"n\">select_text</span><span class=\"p\">)</span>\n                    <span class=\"p\">},</span>\n                    <span class=\"s2\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">pk</span>\n                    <span class=\"p\">}</span>\n                <span class=\"n\">lst_json</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n    <span class=\"k\">elif</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">lat</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">lng</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;geometry&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Point&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;coordinates&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">lng</span><span class=\"p\">,</span>\n                <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">lat</span>\n            <span class=\"p\">]</span>\n        <span class=\"p\">},</span>\n            <span class=\"s2\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Feature&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;properties&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"s2\">&quot;popupContent&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;&lt;b&gt;Name:&lt;/b&gt; </span><span class=\"si\">%s</span><span class=\"s2\">&lt;br/&gt;&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n            <span class=\"p\">},</span>\n            <span class=\"s2\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">pk</span>\n        <span class=\"p\">}</span>\n        <span class=\"n\">lst_json</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">HttpResponse</span><span class=\"p\">(</span><span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span><span class=\"n\">lst_json</span><span class=\"p\">),</span> <span class=\"n\">content_type</span><span class=\"o\">=</span><span class=\"s1\">&#39;application/json&#39;</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@login_required</span>\n<div class=\"viewcode-block\" id=\"getGeoJsonList\"><a class=\"viewcode-back\" href=\"../../../modules/entities/#entities.views.getGeoJsonList\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">getGeoJsonList</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Used to retrieve a list of GeoJsons. To generate the list the kind of connection</span>\n<span class=\"sd\">    and the connected entity is needed&#39;&#39;&#39;</span>\n    <span class=\"n\">relation</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s1\">&#39;relations&#39;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;relation&quot;</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()</span>\n    <span class=\"c1\">#relation_type = request.GET.get(&quot;relation_type&quot;)</span>\n    <span class=\"n\">objects</span> <span class=\"o\">=</span> <span class=\"n\">relation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span>\n            <span class=\"n\">related_place__status</span><span class=\"o\">=</span><span class=\"s1\">&#39;distinct&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">select_related</span><span class=\"p\">(</span><span class=\"s1\">&#39;related_person&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;related_place&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;relation_type&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">lst_json</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n    <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">objects</span><span class=\"p\">:</span>\n        <span class=\"n\">pers_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:person_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n        <span class=\"n\">place_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:place_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n        <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;geometry&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Point&quot;</span><span class=\"p\">,</span>\n                        <span class=\"s2\">&quot;coordinates&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">lng</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">lat</span><span class=\"p\">]</span>\n                        <span class=\"p\">},</span>\n                    <span class=\"s2\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Feature&quot;</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;relation_type&quot;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">relation_type</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;properties&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;popupContent&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;&lt;b&gt;Person:&lt;/b&gt; &lt;a href=&#39;</span><span class=\"si\">%s</span><span class=\"s2\">&#39;&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/a&gt;&lt;br/&gt;&lt;b&gt;Connection:&lt;/b&gt; </span><span class=\"si\">%s</span><span class=\"s2\">&lt;br/&gt;&lt;b&gt;Place:&lt;/b&gt; &lt;a href=&#39;</span><span class=\"si\">%s</span><span class=\"s2\">&#39;&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/a&gt;&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">pers_url</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">relation_type</span><span class=\"p\">,</span> <span class=\"n\">place_url</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"p\">)</span>\n                    <span class=\"p\">},</span>\n                    <span class=\"s2\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">pk</span>\n                    <span class=\"p\">}</span>\n        <span class=\"n\">lst_json</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">r</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"n\">HttpResponse</span><span class=\"p\">(</span><span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span><span class=\"n\">lst_json</span><span class=\"p\">),</span> <span class=\"n\">content_type</span><span class=\"o\">=</span><span class=\"s1\">&#39;application/json&#39;</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@login_required</span>\n<div class=\"viewcode-block\" id=\"getNetJsonList\"><a class=\"viewcode-back\" href=\"../../../modules/entities/#entities.views.getNetJsonList\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">getNetJsonList</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Used to retrieve a Json to draw a network&#39;&#39;&#39;</span>\n    <span class=\"n\">relation</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s1\">&#39;relations&#39;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"s1\">&#39;PersonPlace&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()</span>\n    <span class=\"n\">objects</span> <span class=\"o\">=</span> <span class=\"n\">relation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span>\n            <span class=\"n\">related_place__status</span><span class=\"o\">=</span><span class=\"s1\">&#39;distinct&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">nodes</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n    <span class=\"n\">edges</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n    <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">objects</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">pk</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">nodes</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n            <span class=\"n\">place_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:place_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n            <span class=\"n\">tt</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&lt;div class=&#39;arrow&#39;&gt;&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-header&#39;&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-body&#39;&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Type&lt;/th&gt; &lt;td&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Entity&lt;/th&gt; &lt;td&gt;&lt;a href=&#39;</span><span class=\"si\">%s</span><span class=\"s2\">&#39;&gt;Link&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/div&gt;&quot;</span><span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s1\">&#39;place&#39;</span><span class=\"p\">,</span> <span class=\"n\">place_url</span><span class=\"p\">)</span>\n            <span class=\"n\">nodes</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;place&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;label&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s1\">&#39;id&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">),</span> <span class=\"s1\">&#39;tooltip&#39;</span><span class=\"p\">:</span> <span class=\"n\">tt</span><span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">nodes</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n            <span class=\"n\">pers_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:person_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n            <span class=\"n\">tt</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&lt;div class=&#39;arrow&#39;&gt;&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-header&#39;&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-body&#39;&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Type&lt;/th&gt; &lt;td&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Entity&lt;/th&gt; &lt;td&gt;&lt;a href=&#39;</span><span class=\"si\">%s</span><span class=\"s2\">&#39;&gt;Link&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/div&gt;&quot;</span><span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"p\">),</span> <span class=\"s1\">&#39;person&#39;</span><span class=\"p\">,</span> <span class=\"n\">pers_url</span><span class=\"p\">)</span>\n            <span class=\"n\">nodes</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;person&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;label&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"p\">),</span> <span class=\"s1\">&#39;id&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">),</span> <span class=\"s1\">&#39;tooltip&#39;</span><span class=\"p\">:</span> <span class=\"n\">tt</span><span class=\"p\">}</span>\n        <span class=\"n\">edges</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">({</span><span class=\"s1\">&#39;source&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span> <span class=\"s1\">&#39;target&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_place</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span> <span class=\"s1\">&#39;kind&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">relation_type</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s1\">&#39;id&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n    <span class=\"n\">lst_json</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;edges&#39;</span><span class=\"p\">:</span> <span class=\"n\">edges</span><span class=\"p\">,</span> <span class=\"s1\">&#39;nodes&#39;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"n\">nodes</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">nodes</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">()]}</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">HttpResponse</span><span class=\"p\">(</span><span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span><span class=\"n\">lst_json</span><span class=\"p\">),</span> <span class=\"n\">content_type</span><span class=\"o\">=</span><span class=\"s1\">&#39;application/json&#39;</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@login_required</span>\n<div class=\"viewcode-block\" id=\"getNetJsonListInstitution\"><a class=\"viewcode-back\" href=\"../../../modules/entities/#entities.views.getNetJsonListInstitution\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">getNetJsonListInstitution</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Used to retrieve a Json to draw a network&#39;&#39;&#39;</span>\n    <span class=\"n\">relation</span> <span class=\"o\">=</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"s1\">&#39;relations&#39;</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">=</span><span class=\"s1\">&#39;PersonInstitution&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">model_class</span><span class=\"p\">()</span>\n    <span class=\"n\">objects</span> <span class=\"o\">=</span> <span class=\"n\">relation</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">()</span>\n    <span class=\"n\">nodes</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">()</span>\n    <span class=\"n\">edges</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n    <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">objects</span><span class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_institution</span><span class=\"o\">.</span><span class=\"n\">pk</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">nodes</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n            <span class=\"n\">inst_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:institution_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_institution</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n            <span class=\"n\">tt</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&lt;div class=&#39;arrow&#39;&gt;&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-header&#39;&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-body&#39;&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Type&lt;/th&gt; &lt;td&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Entity&lt;/th&gt; &lt;td&gt;&lt;a href=&#39;</span><span class=\"si\">%s</span><span class=\"s2\">&#39;&gt;Link&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/div&gt;&quot;</span><span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_institution</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s1\">&#39;institution&#39;</span><span class=\"p\">,</span> <span class=\"n\">inst_url</span><span class=\"p\">)</span>\n            <span class=\"n\">nodes</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_institution</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;institution&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;label&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_institution</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s1\">&#39;id&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_institution</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">),</span> <span class=\"s1\">&#39;tooltip&#39;</span><span class=\"p\">:</span> <span class=\"n\">tt</span><span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">nodes</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n            <span class=\"n\">pers_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:person_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n            <span class=\"n\">tt</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&lt;div class=&#39;arrow&#39;&gt;&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-header&#39;&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/div&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;div class=&#39;sigma-tooltip-body&#39;&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Type&lt;/th&gt; &lt;td&gt;</span><span class=\"si\">%s</span><span class=\"s2\">&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">                &lt;tr&gt;&lt;th&gt;Entity&lt;/th&gt; &lt;td&gt;&lt;a href=&#39;</span><span class=\"si\">%s</span><span class=\"s2\">&#39;&gt;Link&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/table&gt;</span><span class=\"se\">\\</span>\n<span class=\"s2\">            &lt;/div&gt;&quot;</span><span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"p\">),</span> <span class=\"s1\">&#39;person&#39;</span><span class=\"p\">,</span> <span class=\"n\">pers_url</span><span class=\"p\">)</span>\n            <span class=\"n\">nodes</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;type&#39;</span><span class=\"p\">:</span> <span class=\"s1\">&#39;person&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;label&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"p\">),</span> <span class=\"s1\">&#39;id&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">),</span> <span class=\"s1\">&#39;tooltip&#39;</span><span class=\"p\">:</span> <span class=\"n\">tt</span><span class=\"p\">}</span>\n        <span class=\"n\">edges</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">({</span><span class=\"s1\">&#39;source&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_person</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span> <span class=\"s1\">&#39;target&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">related_institution</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span> <span class=\"s1\">&#39;kind&#39;</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">relation_type</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"s1\">&#39;id&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n    <span class=\"n\">lst_json</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s1\">&#39;edges&#39;</span><span class=\"p\">:</span> <span class=\"n\">edges</span><span class=\"p\">,</span> <span class=\"s1\">&#39;nodes&#39;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"n\">nodes</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">nodes</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">()]}</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">HttpResponse</span><span class=\"p\">(</span><span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span><span class=\"n\">lst_json</span><span class=\"p\">),</span> <span class=\"n\">content_type</span><span class=\"o\">=</span><span class=\"s1\">&#39;application/json&#39;</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@login_required</span>\n<div class=\"viewcode-block\" id=\"resolve_ambigue_place\"><a class=\"viewcode-back\" href=\"../../../modules/entities/#entities.views.resolve_ambigue_place\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">resolve_ambigue_place</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">pk</span><span class=\"p\">,</span> <span class=\"n\">uri</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Only used to resolve place names.&#39;&#39;&#39;</span>\n    <span class=\"n\">uri</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;http://&#39;</span><span class=\"o\">+</span><span class=\"n\">uri</span>\n    <span class=\"n\">entity</span> <span class=\"o\">=</span> <span class=\"n\">Place</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">pk</span><span class=\"o\">=</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n    <span class=\"n\">lt</span><span class=\"p\">,</span> <span class=\"n\">created</span> <span class=\"o\">=</span> <span class=\"n\">LabelType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_or_create</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s1\">&#39;\u00d6BL place name&#39;</span><span class=\"p\">)</span>\n    <span class=\"n\">lb</span> <span class=\"o\">=</span> <span class=\"n\">Label</span><span class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span class=\"n\">entity</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">label_type</span><span class=\"o\">=</span><span class=\"n\">lt</span><span class=\"p\">,</span> <span class=\"n\">temp_entity</span><span class=\"o\">=</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n    <span class=\"n\">lb</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">pl_n</span> <span class=\"o\">=</span> <span class=\"n\">geonamesPlaceCL</span><span class=\"p\">(</span><span class=\"n\">uri</span><span class=\"p\">)</span>\n    <span class=\"n\">pl_n_1</span> <span class=\"o\">=</span> <span class=\"n\">pl_n</span><span class=\"o\">.</span><span class=\"n\">save_place</span><span class=\"p\">()</span>\n    <span class=\"n\">pl_n_1</span> <span class=\"o\">=</span> <span class=\"n\">pl_n</span><span class=\"o\">.</span><span class=\"n\">merge</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"p\">)</span>\n    <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">reverse_lazy</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:place_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">pl_n_1</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">)})</span>\n    <span class=\"k\">if</span> <span class=\"n\">pl_n</span><span class=\"o\">.</span><span class=\"n\">created</span><span class=\"p\">:</span>\n        <span class=\"n\">pl_n_1</span><span class=\"o\">.</span><span class=\"n\">status</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;distinct (manually resolved)&#39;</span>\n        <span class=\"n\">pl_n_1</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n    <span class=\"n\">UriCandidate</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">entity</span><span class=\"o\">=</span><span class=\"n\">entity</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">)</span></div>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">resolve_ambigue_person</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">PersonResolveUriForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">)</span>\n    <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n        <span class=\"n\">pers</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"n\">redirect</span><span class=\"p\">(</span><span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s1\">&#39;entities:person_edit&#39;</span><span class=\"p\">,</span> <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s1\">&#39;pk&#39;</span><span class=\"p\">:</span> <span class=\"n\">pers</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">}))</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">form</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#   VisualizationViews</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">birth_death_map</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/map_list.html&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">pers_place_netw</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/network.html&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">pers_inst_netw</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/network_institution.html&#39;</span><span class=\"p\">)</span>\n\n\n<span class=\"nd\">@login_required</span>\n<span class=\"k\">def</span> <span class=\"nf\">generic_network_viz</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;GET&#39;</span><span class=\"p\">:</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">NetworkVizFilterForm</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s1\">&#39;entities/generic_network_visualization.html&#39;</span><span class=\"p\">,</span>\n                      <span class=\"p\">{</span><span class=\"s1\">&#39;form&#39;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">})</span>\n\n\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">#  Reversion Views</span>\n<span class=\"c1\">#</span>\n<span class=\"c1\">############################################################################</span>\n<span class=\"c1\">############################################################################</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">PlaceCompareView</span><span class=\"p\">(</span><span class=\"n\">HistoryCompareDetailView</span><span class=\"p\">):</span>\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">Place</span>\n    <span class=\"n\">template_name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;entities/compare_base.html&#39;</span>\n</pre></div>", "parents": [{"title": "Module code", "link": "../../"}], "sidebars": null, "alabaster_version": "0.7.10", "customsidebar": null}